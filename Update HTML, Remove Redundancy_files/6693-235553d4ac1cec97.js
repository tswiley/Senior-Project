"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6693],{60638:function(e,t,n){n.d(t,{kd:function(){return r},Oq:function(){return l},gj:function(){return d}});var a,r,o=n(61888),i=n(45021);function s(e,t){var n=e.slice().sort(function(e,t){return e-t}),a=t*(n.length-1),r=Math.floor(a),o=Math.ceil(a);if(r===o)return n[r];var i=a-r;return(1-i)*n[r]+i*n[o]}(a=r||(r={})).FirstTokenLatency="first_token_lat",a.TotalRequestTime="total_request_time",a.TokenCount="token_count",a.StdDevTokenLatency="std_dev_token_lat",a.MeanTokenLatency="mean_token_lat",a.MedianTokenLatency="median_token_lat",a.MinTokenLatency="min_token_lat",a.MaxTokenLatency="max_token_lat",a.P95TokenLatency="p95_token_lat",a.P99TokenLatency="p99_token_lat";var l=function(e){var t,n=e.filter(function(e){return e.requestCount>1}),a=e.length?e[0]:null,i=s(n.map(function(e){return e.lastTokenDuration}),.95),l=s(n.map(function(e){return e.lastTokenDuration}),.99),d=(0,o.mean)(n.map(function(e){return e.lastTokenDuration})),c=function(e){if(0===e.length)return null;var t=e.slice().sort(function(e,t){return e-t}),n=Math.floor(t.length/2);return t.length%2==0?(t[n-1]+t[n])/2:t[n]}(n.map(function(e){return e.lastTokenDuration})),u=n.filter(function(e){return 0!==e.lastTokenDuration}).reduce(function(e,t){return Math.min(e,t.lastTokenDuration)},1/0),m=n.reduce(function(e,t){return Math.max(e,t.lastTokenDuration)},-1/0),h=function(e){var t=e.length;if(0===t)return 0;var n=(0===e.length?null:e.reduce(function(e,t){return e+t},0)/e.length)||0;return Math.sqrt(e.reduce(function(e,t){return e+Math.pow(t-n,2)},0)/t)}(n.map(function(e){return e.lastTokenDuration})),f=null===(t=e[e.length-1])||void 0===t?void 0:t.requestDuration;return[{id:r.FirstTokenLatency,name:"First Token lat.",stat:a?"".concat(a.lastTokenDuration.toFixed(2),"ms"):null,value:a?a.lastTokenDuration:null,category:"summary"},{id:r.TotalRequestTime,name:"Total request time",stat:f?"".concat((f/1e3).toFixed(2),"s"):null,value:f||null,category:"summary"},{id:r.TokenCount,name:"Token count",stat:"".concat(e.length),value:e.length,category:"summary"},{id:r.StdDevTokenLatency,name:"Std dev Token lat.",stat:"".concat(h.toFixed(2)),value:h,category:"token"},{id:r.MeanTokenLatency,name:"Mean Token lat.",stat:d?"".concat(d.toFixed(2),"ms"):null,value:null!=d?d:null,category:"aggregate"},{id:r.MedianTokenLatency,name:"Median Token lat.",stat:c?"".concat(c.toFixed(2),"ms"):null,value:null!=c?c:null,category:"token"},{id:r.MinTokenLatency,name:"Min Token lat.",stat:"".concat(u.toFixed(2),"ms"),value:null!=u?u:null,category:"token"},{id:r.MaxTokenLatency,name:"Max Token lat.",stat:"".concat(m.toFixed(2),"ms"),value:null!=m?m:null,category:"token"},{id:r.P95TokenLatency,name:"p95 Token lat.",stat:i?"".concat(i.toFixed(2),"ms"):null,value:null!=i?i:null,category:"aggregate"},{id:r.P99TokenLatency,name:"p99 Token lat.",stat:l?"".concat(l.toFixed(2),"ms"):null,value:null!=l?l:null,category:"aggregate"}]},d=function(){var e,t=(0,i.JP)(),n=(0,i.AA)();if(!t||!n)return{stats:[],targetLatencyData:[]};var a=t[n],r=null!==(e=null==a?void 0:a.data)&&void 0!==e?e:[];return{stats:l(r),targetLatencyData:r}}},45021:function(e,t,n){n.d(t,{AA:function(){return T},Ae:function(){return f},BC:function(){return M},F4:function(){return h},JP:function(){return w},Q7:function(){return b},WD:function(){return x},gL:function(){return g},iZ:function(){return y},j7:function(){return k},kn:function(){return v}});var a=n(96237),r=n(39324),o=n(71209),i=n(64502),s=n(86646),l=n(78103),d=n(60638),c=(0,l.ZP)(function(){return{messagesDevData:{},activeNodeId:void 0,ui:{focusedNodeId:void 0}}}),u=c.getState,m=c.setState,h=function(e,t,n,i){m(function(s){return(0,o._)((0,r._)({},s),{activeNodeId:e,ui:{focusedNodeId:e},messagesDevData:(0,o._)((0,r._)({},s.messagesDevData),(0,a._)({},e,{status:"active",data:[],model:t,serverRequestId:n,preflightTime:i}))})})},f=function(e,t){m(function(n){var s=n.messagesDevData[e];return(0,o._)((0,r._)({},n),{activeNodeId:e,messagesDevData:(0,o._)((0,r._)({},n.messagesDevData),(0,a._)({},e,(0,o._)((0,r._)({},s),{data:(0,i._)(s.data).concat([t])})))})})},p=function(e,t){var n;return null===(n=t.find(function(t){return t.id===e}))||void 0===n?void 0:n.value},g=function(e){var t=w()[e],n=(0,d.Oq)(t.data),a=t.preflightTime,r={model:t.model,serverRequestId:t.serverRequestId,preflightTime:a,countTokens:p(d.kd.TokenCount,n),tsFirstToken:p(d.kd.FirstTokenLatency,n),tsMaxTokenTime:p(d.kd.MaxTokenLatency,n),tsMeanTokenWithoutFirst:p(d.kd.MeanTokenLatency,n),tsMedianTokenWithoutFirst:p(d.kd.MedianTokenLatency,n),tsMinTokenTime:p(d.kd.MinTokenLatency,n),tsStdDevTokenTime:p(d.kd.StdDevTokenLatency,n),tsP95TokenWithoutFirst:p(d.kd.P95TokenLatency,n),tsP99TokenWithoutFirst:p(d.kd.P99TokenLatency,n),tsTotalRequestTime:p(d.kd.TotalRequestTime,n)};s.ZP.postLatencyTimingEvent(r)},v=function(e){return m(function(t){var n=(0,o._)((0,r._)({},t.messagesDevData[e]),{status:"finished"});return(0,o._)((0,r._)({},t),{messagesDevData:(0,o._)((0,r._)({},t.messagesDevData),(0,a._)({},e,n))})})},x=function(e){return m(function(t){return(0,o._)((0,r._)({},t),{ui:(0,o._)((0,r._)({},t.ui),{focusedNodeId:e})})})};function b(e){var t=Object.keys(w()),n=t.indexOf(e);if(-1===n)throw Error("Key not found in object");var a=(n+1)%t.length;return t[a]}function y(e){var t=Object.keys(w()),n=t.indexOf(e);if(-1===n)throw Error("Key not found in object");var a=(n-1+t.length)%t.length;return t[a]}function k(e){return Object.keys(w()).indexOf(e)}var M=function(){return Object.keys(w()).length},w=function(){return u().messagesDevData},T=function(){return u().ui.focusedNodeId}},95413:function(e,t,n){n.d(t,{Z:function(){return M}});var a=n(39324),r=n(4337),o=n(35250),i=n(7813),s=n(55548),l=n(17944),d=n(54636),c=n(42780),u=n(38574),m=n(19841),h=n(1454),f=n(32004),p=n(94968),g=n(21389),v=n(31731),x=n(72290);function b(){var e=(0,r._)(["flex px-3 min-h-[44px] py-1 items-center gap-3 transition-colors duration-200 dark:text-white cursor-pointer text-sm"]);return b=function(){return e},e}var y=g.Z.a(b());function k(e){var t=e.onClick,n=e.href,a=e.target,r=e.children;return(0,o.jsx)(i.v.Item,{children:function(e){var i=e.active;return(0,o.jsx)(y,{as:void 0!==n?"a":"button",onClick:t,href:n,target:a,className:(0,m.default)(i?"bg-gray-100 dark:bg-gray-800":"hover:bg-gray-100 dark:hover:bg-gray-800"),children:r})}})}function M(){var e=(0,l.aF)();return(0,o.jsxs)(i.v,{as:"div",className:"group relative",children:[(0,o.jsx)(i.v.Button,{className:"flex items-center justify-center rounded-full border border-gray-200 bg-gray-50 text-gray-600 dark:border-white/10 dark:bg-white/10 dark:text-gray-200",children:(0,o.jsx)("div",{className:"flex h-6 w-6 items-center justify-center text-xs",children:"?"})}),(0,o.jsx)(v.m,{children:(0,o.jsxs)(i.v.Items,{className:"absolute bottom-full right-0 z-20 mb-2 w-full min-w-[175px] overflow-hidden rounded-md bg-gray-50 pb-1.5 pt-1 outline-none dark:bg-gray-950",children:[e&&(0,o.jsx)(k,{onClick:function(){(0,u.S)(null==e?void 0:e.id).then(function(){x.m.success("Copied your User ID to clipboard")})},children:(0,o.jsx)("span",{className:"truncate text-xs text-black/20 dark:text-white/30",children:null==e?void 0:e.email})}),(0,o.jsxs)(k,{as:"a",href:"https://help.openai.com/en/collections/3742473-chatgpt",target:"_blank",onClick:function(){d.A.logEvent(c.M.clickFaqLink)},children:[(0,o.jsx)(h.AlO,{className:"icon-sm"}),(0,o.jsx)("span",{className:"text-xs",children:(0,o.jsx)(f.Z,(0,a._)({},w.helpAndFaq))})]}),(0,o.jsxs)(k,{as:"a",href:"https://help.openai.com/en/articles/6825453-chatgpt-release-notes",target:"_blank",children:[(0,o.jsx)(h.AlO,{className:"icon-sm"}),(0,o.jsx)("span",{className:"text-xs",children:(0,o.jsx)(f.Z,(0,a._)({},w.releaseNotes))})]}),(0,o.jsxs)(k,{as:"a",href:"https://openai.com/policies",target:"_blank",onClick:function(){d.A.logEvent(c.M.clickPrivacyPolicy)},children:[(0,o.jsx)(h.AlO,{className:"icon-sm"}),(0,o.jsx)("span",{className:"text-xs",children:(0,o.jsx)(f.Z,(0,a._)({},w.termsAndPolicies))})]}),(0,o.jsxs)(k,{onClick:function(){s.vm.openModal(s.B.KeyboardActions)},children:[(0,o.jsx)(h.aCJ,{className:"icon-sm"}),(0,o.jsx)("span",{className:"text-xs",children:(0,o.jsx)(f.Z,(0,a._)({},w.keyboardShortcutsMenu))})]})]})})]})}var w=(0,p.vU)({helpAndFaq:{id:"thread.helpAndFaq",defaultMessage:"Help & FAQ",description:"Help & FAQ menu item"},releaseNotes:{id:"thread.releaseNotes",defaultMessage:"Release notes",description:"Release notes menu item"},termsAndPolicies:{id:"thread.termsAndPolicies",defaultMessage:"Terms & policies",description:"Terms & Policies menu item"},keyboardShortcutsMenu:{id:"thread.keyboardShortcutsMenu",defaultMessage:"Keyboard shortcuts",description:"Keyboard shortcuts menu item"}})},96693:function(e,t,n){n.d(t,{Z:function(){return na}});var a,r,o=n(21722),i=n(39324),s=n(71209),l=n(70216),d=n(10064),c=n(4337),u=n(38104),m=n(35250),h=n(21950),f=n(2064),p=n(4536),g=n(54636),v=n(42780),x=n(5397),b=n.n(x),y=n(29124),k=n.n(y),M=n(73040),w=n.n(M),T=n(10721),C=n(70079),j=n(1454),_=n(13002),I=n(22584),N=n(94968),S=n(32004),D=n(70671),R=n(21389),A=n(8844),P=n(61098),L=n(86646),Z=n(62682),q=n(66638),B=n(72871),E=n(55548),F=n(17944),U=n(25687),O=n(1491),z=n(86925),Q=n(18481),G=n(39368),W=n(48133),V=n(41955),H=n(84056),J=n(64502),Y=n(19841),K=n(91530),$=n.n(K),X=n(2827),ee=n(15066),et=n(13205),en=n(36696),ea=n(94705),er=n(7184),eo=n(15635),ei=n(72290);function es(){var e=(0,c._)(["mb-2 mt-auto ml-auto mr-auto"]);return es=function(){return e},e}function el(){var e=(0,c._)(["relative rounded-md border border-black/10 bg-gray-50 dark:border-gray-900/50 dark:bg-[#444654] flex flex-col overflow-hidden"]);return el=function(){return e},e}function ed(){var e=(0,c._)(["mb-5 border dark:bg-gray-800 overflow-hidden"]);return ed=function(){return e},e}function ec(){var e=(0,c._)([""]);return ec=function(){return e},e}var eu=(0,N.vU)({submitFeedback:{id:"feedbackModal.submitFeedback",defaultMessage:"Submit feedback",description:"Button text for submitting the feedback"},submitReport:{id:"feedbackModal.submitReport",defaultMessage:"Submit report",description:"Button text for submitting a content-moderation report"},submitRejectModeration:{id:"feedbackModal.moderationReject",defaultMessage:"Block Content",description:"Button text for rejecting the share link and blocking it from being viewed"},submitAcceptModeration:{id:"feedbackModal.moderationAccept",defaultMessage:"Allow Content",description:"Button text for accepting the share link and allowing it to be viewed"},thumbsUpPlaceholder:{id:"feedbackModal.thumbsUpPlaceholder",defaultMessage:"What do you like about the response?",description:"Placeholder for textarea input when user chooses thumbs up"},thumbsDownPlaceholder:{id:"feedbackModal.thumbsDownPlaceholder",defaultMessage:"What was the issue with the response? How could it be improved?",description:"Placeholder for textarea input when user chooses thumbs down"},reportContentExplanationPlaceholder:{id:"feedbackModal.reportContentExplanationPlaceholder",defaultMessage:"What is wrong with the response? What about this response is harmful? Please be as specific as possible, and add any details that are not present in the checkboxes below.",description:"Placeholder for textarea input when user chooses to report a shared chat"},harmfulUnsafe:{id:"feedbackModal.harmfulUnsafe",defaultMessage:"This is harmful / unsafe",description:"Label for harmful/unsafe checkbox"},harmfulOffensive:{id:"feedbackModal.harmfulOffensive",defaultMessage:"This content is harmful or offensive",description:"Label for harmful/offensive checkbox"},copyrightContent:{id:"feedbackModal.copyrightContent",defaultMessage:"This content violates copyright law",description:"Label for Copyrighted Content checkbox"},reportOtherContent:{id:"feedbackModal.reportOtherContent",defaultMessage:"I don't like this for some other reason (please describe)",description:"Label for Report Other Content checkbox"},notTrue:{id:"feedbackModal.notTrue",defaultMessage:"This isn't true",description:"Label for not true checkbox"},notHelpful:{id:"feedbackModal.notHelpful",defaultMessage:"This isn't helpful",description:"Label for not helpful checkbox"},dontLikeThis:{id:"feedbackModal.dontLikeThis",defaultMessage:"I don't like this",description:"Label for I Don't Like This checkbox"},sexualAbuse:{id:"feedbackModal.sexualAbuse",defaultMessage:"This content contains sexual abuse",description:"Label for Sexual Abuse checkbox"},provideAdditionalFeedback:{id:"feedbackModal.provideAdditionalFeedback",defaultMessage:"Provide additional feedback",description:"Title for the critique feedback modal"},provideReportModalTitle:{id:"feedbackModal.provideReportModalTitle",defaultMessage:"Report This Content",description:"Title for the 'report' feedback modal"},pickBestAnswer:{id:"feedbackModal.pickBestAnswer",defaultMessage:"Pick the best answer to improve the model",description:"Title for the compare feedback modal"},newAnswer:{id:"feedbackModal.newAnswer",defaultMessage:"New Answer",description:"Title for the new answer during comparison"},originalAnswer:{id:"feedbackModal.originalAnswer",defaultMessage:"Original Answer",description:"Title for the original answer during comparison"},newAnswerBetter:{id:"feedbackModal.newAnswerBetter",defaultMessage:"New answer is better",description:"Button text for choosing new answer during comparison"},originalAnswerBetter:{id:"feedbackModal.originalAnswerBetter",defaultMessage:"Original answer is better",description:"Button text for choosing original answer during comparison"},neitherAnswerBetter:{id:"feedbackModal.neitherAnswerBetter",defaultMessage:"Neither answer is better",description:"Button text for choosing neither answer during comparison"},skipStep:{id:"feedbackModal.skipStep",defaultMessage:"Skip this step",description:"Button text for skipping comparison step"},continueWithChosenAnswer:{id:"feedbackModal.continueWithChosenAnswer",defaultMessage:"The conversation will continue with the answer you choose.",description:"Information text for user during comparison"},employeeConsent:{id:"feedbackModal.employeeConsent",defaultMessage:"Allow this content to be used for model evals",description:"Open AI employee is consenting to allow this content to be used in evals"},employeeConsentExplanation:{id:"feedbackModal.employeeConsentExplanation",defaultMessage:"Allow your feedback and conversation to be used to in model evals. Please verify there is no confidential data in the conversation.",description:"Explanation for employee consent checkbox"}});function em(e){var t,n,a,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(null==e?void 0:null===(t=e.messages)||void 0===t?void 0:t.length)===1&&!(null==e?void 0:null===(n=e.messages)||void 0===n?void 0:n.some(function(e){return"error"in e}))&&(!r||!((null==e?void 0:null===(a=e.messages)||void 0===a?void 0:a.length)===1&&(0,z.RR)(null==e?void 0:e.messages[0].message).length<20))}function eh(e){var t,n,a=e.ratingModalNodeId,r=e.ratingModalOpen,o=e.onCloseRatingModal,s=e.onSubmitFeedback,l=e.onHandleChangeFeedbackComparisonRating,c=e.feedbackTextareaRef,u=e.clientThreadId,h=e.currentModelId,f=e.onChangeItemInView,x=e.onRequestMoreCompletions,b=e.onRequestCompletion,y=(0,D.Z)(),k=q.tQ.getTree(u),M=(0,q.XK)(u),w=(0,F.aF)(),T=!!w&&(0,p.yl)(w),_=(0,d._)((0,C.useState)(!1),2),I=_[0],N=_[1];(0,C.useEffect)(function(){"report"===r&&p.pg.forceEnableSession()},[r]);var R=(0,C.useRef)(.5>Math.random()?"left":"right"),A=null==k?void 0:k.getConversationTurns(a||"root"),P=A.length-1,Z=A[A.length-1],B=(0,d._)((0,C.useState)("critique"),2),E=B[0],U=B[1],z=(0,O.w$)(),Q=em(Z,!0)&&z,G=(0,C.useMemo)(function(){return{id:a||"root",threadId:q.tQ.getServerThreadId(u),rating:r,model:h}},[a,u,r,h]),W=null==A?void 0:A[(null==A?void 0:A.length)-1].variantIds,H=null==W?void 0:W[(null==W?void 0:W.length)-1],K=(n=(t=null==k?void 0:k.getConversationTurns(H))[t.length-1]).messages[n.messages.length-1].nodeId,es=null==k?void 0:k.getConversationTurns(K),el=(0,C.useMemo)(function(){var e=null==es?void 0:es[(null==es?void 0:es.length)-1];return"thumbsDown"===r&&Q&&em(e)&&em(Z)},[r,Q,es,Z]),ed=(0,C.useRef)(Date.now()),ec=(0,C.useRef)(-1),eh=(0,C.useRef)(Date.now()),ex=(0,C.useRef)(Date.now());(0,C.useEffect)(function(){"compare"===E?(ec.current=Date.now(),g.A.logEvent(v.M.displayedComparisonUIV0,G)):"critique"===E&&"thumbsDown"===r&&g.A.logEvent(v.M.displayedThumbsDownFeedbackForm,G)},[E]);var eb=A.length-2,ey=es.length-1,ek=es[es.length-1],eM=(0,C.useMemo)(function(){return ek&&ee.Cv.getRequestIdFromConversationTurn(ek)},[ek]),ew=(0,V.Yk)(eM);(0,C.useMemo)(function(){ew||(ex.current=Date.now())},[ew]);var eT=Z.messages,eC=eT[eT.length-1],ej=eC.message.id,e_=eC.nodeId,eI=k.getLeafFromNode(e_),eN=ek.messages,eS=eN[eN.length-1],eD=eS.message.id,eR=eS.nodeId,eA=k.getLeafFromNode(eR),eP="critique"===E?"report"===r?y.formatMessage(eu.provideReportModalTitle):y.formatMessage(eu.provideAdditionalFeedback):y.formatMessage(eu.pickBestAnswer),eL=(0,C.useRef)([]),eZ=(0,C.useRef)(""),eq=(0,C.useCallback)(function(){var e,t=null===(e=c.current)||void 0===e?void 0:e.elements;eL.current=(0,J._)(t||[]).filter(function(e){return e.checked}).map(function(e){return e.id}).map(function(e){return e.replace("feedback-","")}),eZ.current=(null==t?void 0:t["feedback-other"].value)||""},[c]),eB=(0,C.useCallback)(function(){eq(),s({customFeedback:eZ.current,tags:eL.current,employeeConsented:T?I:void 0}),"thumbsDown"===r&&g.A.logEvent(v.M.submitThumbsDownFeedbackForm,G),el?U("compare"):o()},[eq,s,T,I,r,el,G,o]),eE=(0,C.useCallback)(function(e,t){var n=q.tQ.getServerThreadId(u);if(null!=n){var a=k.getMessageId(q.tQ.getThreadCurrentLeafId(u));L.ZP.submitSharedConversationReportFeedback({message_id:a,shared_conversation_id:n,text:e,tags:t}).then(function(){ei.m.success("Moderation logged successfully")}).catch(function(){ei.m.danger("Moderation NOT logged successfully! Please try again")}),o()}},[k,u,o]),eF=(0,C.useCallback)(function(){eq(),eL.current.push("moderation-reject"),eE(eZ.current,eL.current)},[eE,eq]),eU=(0,C.useCallback)(function(){eq(),eL.current.push("moderation-accept"),eE(eZ.current,eL.current)},[eE,eq]),eO="moderate"===r?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ea.ZP.Button,{title:y.formatMessage(eu.submitRejectModeration),color:"danger",onClick:eF}),(0,m.jsx)(ea.ZP.Button,{title:y.formatMessage(eu.submitAcceptModeration),color:"primary",onClick:eU})]}):"critique"===E?(0,m.jsxs)("div",{className:"flex items-center gap-3",children:[T&&"report"!==r&&(0,m.jsx)(eo.u,{label:y.formatMessage(eu.employeeConsentExplanation),children:(0,m.jsx)(et.Z,{id:"employee-consent",checked:I,onChange:function(e){return N(e.currentTarget.checked)},label:y.formatMessage(eu.employeeConsent)})}),(0,m.jsx)(ea.ZP.Button,{title:y.formatMessage("report"===r?eu.submitReport:eu.submitFeedback),onClick:eB})]}):null,ez="left"===R.current,eQ=ez?e_:eR,eG=ez?"new":"original",eW=ez?"original":"new",eV=ez?y.formatMessage(eu.newAnswer):y.formatMessage(eu.originalAnswer),eH=ez?y.formatMessage(eu.originalAnswer):y.formatMessage(eu.newAnswer),eJ=ez?y.formatMessage(eu.newAnswerBetter):y.formatMessage(eu.originalAnswerBetter),eY=ez?y.formatMessage(eu.originalAnswerBetter):y.formatMessage(eu.newAnswerBetter),eK=r&&"report"!==r&&"moderate"!==r,e$=(0,C.useCallback)(function(e){var t="left"===e?eG:"right"===e?eW:"same";if(g.A.logEvent(v.M.submittedComparisonUIV0,Object.assign({},G,{choice:t})),eK){var n=q.tQ.getTree(u);n.updateNodeMetadata(e_,{inlineComparisonRating:"baseline"}),n.updateNodeMetadata(eR,{inlineComparisonRating:t}),l(ej,eD,r,t,R.current,ed.current,ec.current,eh.current,ex.current,eZ.current,eL.current)}q.tQ.setThreadCurrentLeafId(u,e===R.current?eA.id:eI.id),o()},[eG,eW,G,eK,u,eA.id,eI.id,o,e_,eR,l,ej,eD,r]),eX=!ew&&null!=ex.current&&el,e0=(0,C.useCallback)(function(){o(),"critique"===E?g.A.logEvent(v.M.skippedThumbsDownFeedbackForm,Object.assign({},G)):"compare"===E&&g.A.logEvent(v.M.skippedComparisonUIV0,Object.assign({},G))},[o,G,E]),e1=(0,d._)((0,C.useState)([]),2),e2=e1[0],e4=e1[1];return(0,C.useEffect)(function(){"moderate"===r&&L.ZP.fetchShareModerationCategories().then(function(e){var t=e.moderation_categories;e4(Object.keys(t).map(function(e){return[e,t[e]]}))})},[]),(0,m.jsxs)(er.Z,{isOpen:!0,onClose:e0,size:"custom",className:"md:max-w-[672px] lg:max-w-[896px] xl:max-w-6xl",type:"critique"===E?"thumbsUp"===r?"success":"danger":"success",icon:"critique"===E?"thumbsUp"===r?j.fmn:j.oLd:void 0,title:eP,closeButton:(0,m.jsx)(ea.ZP.CloseButton,{onClose:e0}),children:["critique"===E&&(0,m.jsxs)("form",{ref:c,children:[(0,m.jsx)(X.ZP,{id:"feedback-other",placeholder:"thumbsUp"===r?y.formatMessage(eu.thumbsUpPlaceholder):"report"===r?y.formatMessage(eu.reportContentExplanationPlaceholder):y.formatMessage(eu.thumbsDownPlaceholder),rows:3,className:"mb-1 mt-4 w-full resize-none rounded-md dark:bg-gray-800 dark:focus:border-white dark:focus:ring-white"}),"thumbsDown"===r&&(0,m.jsxs)("div",{className:"mb-4",children:[(0,m.jsx)(et.Z,{id:"feedback-harmful",label:y.formatMessage(eu.harmfulUnsafe)}),(0,m.jsx)(et.Z,{id:"feedback-false",label:y.formatMessage(eu.notTrue)}),(0,m.jsx)(et.Z,{id:"feedback-not-helpful",label:y.formatMessage(eu.notHelpful)})]}),null!=r&&!eK&&(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)("div",{className:"mb-4",children:["report"===r&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(et.Z,{id:"feedback-dont-like-this",label:y.formatMessage(eu.dontLikeThis)}),(0,m.jsx)(et.Z,{id:"feedback-false",label:y.formatMessage(eu.notTrue)}),(0,m.jsx)(et.Z,{id:"feedback-not-helpful",label:y.formatMessage(eu.notHelpful)}),(0,m.jsx)(et.Z,{id:"feedback-harmful-offensive",label:y.formatMessage(eu.harmfulOffensive)}),(0,m.jsx)(et.Z,{id:"feedback-sexual-abuse",label:y.formatMessage(eu.sexualAbuse)})]}),"moderate"===r&&(0,m.jsxs)(m.Fragment,{children:[e2.map(function(e){var t=(0,d._)(e,2),n=t[0],a=t[1];return(0,m.jsx)(et.Z,{id:"feedback-"+n,label:a},n)}),(0,m.jsx)(et.Z,{id:"feedback-copyright",label:y.formatMessage(eu.copyrightContent)})]}),(0,m.jsx)(et.Z,{id:"feedback-content-other",label:y.formatMessage(eu.reportOtherContent)})]})})]}),"compare"===E&&es&&void 0!==M&&(0,m.jsxs)("div",{className:(0,Y.default)("w-full"),children:[(0,m.jsx)("p",{className:(0,Y.default)("mb-7 mt-3"),children:(0,m.jsx)(S.Z,(0,i._)({},eu.continueWithChosenAnswer))}),(0,m.jsx)(eg,{className:"rounded-md",children:(0,m.jsx)(ev,{children:(0,m.jsx)(en.ZP,{currentModelId:h,turnIndex:eb,conversationLeafId:eQ,isFinalTurn:!1,clientThreadId:u,onChangeItemInView:f,onChangeRating:$(),onRequestMoreCompletions:x,onRequestCompletion:b,showInlineEmbeddedDisplay:!0})})}),(0,m.jsxs)("div",{className:(0,Y.default)(),children:[(0,m.jsxs)("div",{className:(0,Y.default)("mb-2 grid w-full grid-cols-2 gap-5"),children:[(0,m.jsx)("div",{children:(0,m.jsx)("p",{className:(0,Y.default)("font-semibold"),children:eV})}),(0,m.jsx)("div",{children:(0,m.jsx)("p",{className:(0,Y.default)("font-semibold"),children:eH})})]}),(0,m.jsxs)("div",{className:(0,Y.default)("mb-5 grid w-full grid-cols-2 gap-5"),children:[(0,m.jsxs)(ep,{children:[(0,m.jsx)(ev,{children:(0,m.jsx)(en.ZP,{currentModelId:h,turnIndex:ez?ey:P,conversationLeafId:ez?eR:e_,isFinalTurn:!0,clientThreadId:u,onChangeItemInView:f,onChangeRating:$(),onRequestMoreCompletions:x,onRequestCompletion:b,showInlineEmbeddedDisplay:!0})}),(0,m.jsx)(ef,{children:(0,m.jsx)(ea.ZP.Button,{disabled:!eX,title:eJ,onClick:function(){return e$("left")},color:"dark"})})]}),(0,m.jsxs)(ep,{children:[(0,m.jsx)(ev,{children:(0,m.jsx)(en.ZP,{currentModelId:h,turnIndex:ez?P:ey,conversationLeafId:eQ,isFinalTurn:!0,clientThreadId:u,onChangeItemInView:f,onChangeRating:$(),onRequestMoreCompletions:x,onRequestCompletion:b,showInlineEmbeddedDisplay:!0})}),(0,m.jsx)(ef,{children:(0,m.jsx)(ea.ZP.Button,{disabled:!eX,title:eY,onClick:function(){return e$("right")},color:"dark"})})]})]}),(0,m.jsx)("div",{className:(0,Y.default)("grid w-full"),children:(0,m.jsxs)("div",{className:(0,Y.default)("mb-2 text-right"),children:[(0,m.jsx)(ea.ZP.Button,{disabled:!eX,title:y.formatMessage(eu.neitherAnswerBetter),color:"primary",onClick:function(){return e$("same")},className:(0,Y.default)("mr-2")}),(0,m.jsx)(ea.ZP.Button,{title:y.formatMessage(eu.skipStep),onClick:function(){return o()}})]})})]})]}),(0,m.jsx)(ea.ZP.Actions,{primaryButton:eO})]},"RatingModal-".concat(a))}var ef=R.Z.div(es()),ep=R.Z.div(el()),eg=R.Z.div(ed()),ev=R.Z.div(ec()),ex=n(41711),eb=n(61888);function ey(e){var t,n=e.clientThreadId,a=e.currentLeafId,r=e.currentModelId,i=e.onChangeItemInView,s=e.onRequestMoreCompletions,l=e.onChangeRating,c=e.onRequestCompletion,h=e.ratingModalOpen,f=e.ratingModalNodeId,p=e.ratingModalCompletionId,x=e.sharedConversationReportModalNodeId,b=e.sharedConversationModerationModalOpen,y=e.setRatingModalOpen,k=e.setSharedConversationReportModalNodeId,M=e.setSharedConversationModerationModalOpen,w=(0,D.Z)(),T=(0,C.useRef)(null),j=(0,d._)((0,C.useState)(!1),2),_=j[0],I=j[1],N=(0,C.useCallback)(function(e){var t=e.customFeedback,a=e.tags,o=e.employeeConsented;if(h&&null!=f&&""!==f&&(t||a.length>0||o)){var i=q.tQ.getServerThreadId(n);g.A.logEvent(v.M.reportResult,{id:p,threadId:i,content:t,model:r,rating:h,tags:a}),n&&p&&L.ZP.submitMessageFeedback({message_id:p,conversation_id:i,rating:h,text:t,tags:a,employee_consented:o})}},[h,f,n,p,r]),S=(0,C.useCallback)(function(e){var t=e.customFeedback,a=e.tags;if(null!=x&&""!==x){var o=q.tQ.getServerThreadId(n);g.A.logEvent(v.M.reportResult,{id:p,threadId:o,content:t,model:r,rating:h,tags:a}),L.ZP.submitSharedConversationReportFeedback({message_id:x,shared_conversation_id:o,text:t,tags:a}),I(!0)}},[x,n,p,r,h,I]),R=(0,C.useCallback)((t=(0,o._)(function(e,t,a,r,o,i,s,l,d,c,m){return(0,u.Jh)(this,function(u){switch(u.label){case 0:return[4,L.ZP.submitMessageComparisonFeedback({feedback_version:"comparison_feedback_modal:a:1.0",original_message_id:e,new_message_id:t,rating:a,conversation_id:q.tQ.getServerThreadId(n),text:c,tags:m.map(function(e){return e.replace("feedback-","")}),completion_comparison_rating:r,new_completion_placement:o,feedback_start_time:i,compare_step_start_time:s,new_completion_load_start_time:l,new_completion_load_end_time:d,frontend_submission_time:Date.now(),timezone_offset_min:new Date().getTimezoneOffset()})];case 1:return u.sent(),[2]}})}),function(e,n,a,r,o,i,s,l,d,c,u){return t.apply(this,arguments)}),[n]);return null!=h?(0,m.jsx)(eh,{ratingModalNodeId:f,ratingModalOpen:h,onCloseRatingModal:function(){return y(void 0)},onSubmitFeedback:N,onHandleChangeFeedbackComparisonRating:R,currentModelId:r,feedbackTextareaRef:T,clientThreadId:n,onChangeItemInView:i,onRequestMoreCompletions:s,onChangeRating:l,onRequestCompletion:c}):null!=x?(0,m.jsx)(eh,{ratingModalNodeId:x,ratingModalOpen:"report",onCloseRatingModal:function(){return k(void 0)},onSubmitFeedback:S,onHandleChangeFeedbackComparisonRating:eb.noop,currentModelId:r,feedbackTextareaRef:T,clientThreadId:n,onChangeItemInView:i,onRequestMoreCompletions:s,onChangeRating:l,onRequestCompletion:c}):_?(0,m.jsx)(er.Z,{onClose:function(){return I(!1)},isOpen:!0,icon:ex.Z,title:w.formatMessage(ek.reportModalThankYouTitle),description:w.formatMessage(ek.reportModalThankYouDescription),primaryButton:(0,m.jsx)(ea.ZP.Button,{onClick:function(){return I(!1)},title:w.formatMessage(ek.reportModalThankYouDismiss)}),type:"danger"}):b?(0,m.jsx)(eh,{ratingModalNodeId:a,ratingModalOpen:"moderate",onCloseRatingModal:function(){return M(!1)},onSubmitFeedback:eb.noop,onHandleChangeFeedbackComparisonRating:function(){},currentModelId:r,feedbackTextareaRef:T,clientThreadId:n,onChangeItemInView:i,onRequestMoreCompletions:s,onChangeRating:l,onRequestCompletion:c}):null}var ek=(0,N.vU)({reportModalThankYouTitle:{id:"thread.modal.reportModalThankYou.title",defaultMessage:"Thank you for your report!",description:"Title for the post-report thank-you modal"},reportModalThankYouDescription:{id:"thread.modal.reportModalThankYou.description",defaultMessage:"Thank you for your report.",description:"Description for the post-report thank-you modal"},reportModalThankYouDismiss:{id:"thread.modal.reportModalThankYou.dismissButton",defaultMessage:"Close",description:"Close button for the post-report thank-you modal"}}),eM=n(12065),ew=n(61236),eT=n(82473),eC=n(25494),ej=n(8874),e_=n(25005),eI=n(42798);function eN(e){var t,n=e.isOpen,a=e.onClose,r=(0,C.useCallback)(function(){g.A.logEvent(v.M.closeAccountPaymentModal),a()},[a]),o=(0,ew.a)({queryKey:["referralInvites"],queryFn:function(){return L.ZP.getEligibleReferralInvites()},enabled:n}),l=o.data,d=o.isLoading,c=o.isSuccess,u=null!==(t=null==l?void 0:l.invites_remaining)&&void 0!==t?t:0,h=c?l.invite_codes:[];return((0,C.useEffect)(function(){n&&(ej.m9.logEvent("chatgpt_referral_invite_modal_opened"),g.A.logEvent(v.M.chatgptReferralInviteModalOpened))},[n]),c)?(0,m.jsxs)(e_.x,{isOpen:n,onClose:a,children:[(0,m.jsxs)("div",{className:"flex w-full flex-row items-center justify-between border-b px-4 py-3 dark:border-gray-700",children:[(0,m.jsx)("span",{className:"text-base font-semibold sm:text-base",children:(0,m.jsx)(S.Z,(0,s._)((0,i._)({},eA.modalTitle),{values:{remainingInviteCount:u}}))}),(0,m.jsx)("button",{className:"text-gray-700 opacity-50 transition hover:opacity-75 dark:text-white",onClick:r,children:(0,m.jsx)(j.q5L,{className:"h-6 w-6"})})]}),(0,m.jsx)("div",{className:"px-4 py-4",children:(0,m.jsx)("div",{className:"relative col-span-1 px-3 md:w-[500px] md:px-0",children:(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"flex flex-col items-center pb-5 pt-4",children:(0,m.jsx)(j.E33,{className:"h-12 w-12 text-gray-800"})}),(0,m.jsxs)("div",{className:"flex flex-col items-center gap-2 text-center",children:[(0,m.jsx)("p",{className:"text-xl font-semibold leading-6",children:(0,m.jsx)(S.Z,(0,i._)({},eA.inviteDescription))}),(0,m.jsx)("p",{className:"max-w-sm text-xs text-gray-500",children:(0,m.jsx)(S.Z,(0,i._)({},eA.inviteDescriptionFollowUp))})]}),(0,m.jsxs)("div",{className:"mt-6",children:[(0,m.jsxs)("div",{className:"flex flex-row justify-between px-2",children:[(0,m.jsx)("label",{className:"block text-sm font-medium text-gray-900",children:(0,m.jsx)(S.Z,(0,i._)({},eA.referralCodeLabel))}),(0,m.jsx)("label",{className:"block text-sm text-gray-500",children:(0,m.jsx)(S.Z,(0,s._)((0,i._)({},eA.inviteRemaining),{values:{remainingInviteCount:u}}))})]}),d?(0,m.jsx)("div",{className:"h-40 py-2",children:(0,m.jsx)(eI.Z,{className:"h-4 w-4"})}):null,(null==h?void 0:h.length)>0&&(0,m.jsx)(eD,{referralCodes:h})]})]})})})]}):null}var eS=function(e){return"".concat(window.location.host,"/invite/").concat(e)},eD=function(e){var t=e.referralCodes,n=(0,C.useRef)(null);return(0,m.jsx)("div",{className:"mt-2 flow-root",children:(0,m.jsx)("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,m.jsx)("div",{className:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8",children:(0,m.jsx)("div",{ref:n,className:(0,Y.default)("shadow ring-1 ring-black ring-opacity-5 sm:rounded-md",{"h-44 overflow-y-scroll":t.length>4,"overflow-hidden":t.length<=4}),children:(0,m.jsx)("table",{className:"min-w-full",children:(0,m.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white dark:divide-gray-900 dark:bg-gray-800",children:t.sort(function(e,t){var n={activated:0,created:1,claimed:2,subscription_granted:3},a=e.status,r=t.status;return n[a]<n[r]?-1:n[a]>n[r]?1:e.updated_at>t.updated_at?-1:e.updated_at<t.updated_at?1:0}).map(function(e){return(0,m.jsx)(eR,{tableRef:n,referralCode:e},e.id)})})})})})})})},eR=function(e){var t,n=e.referralCode,a=e.tableRef,r=(0,D.Z)(),s=(0,C.useRef)(null),l=(0,d._)((0,C.useState)(!1),2),c=l[0],h=l[1],f=(0,d._)((0,C.useState)(!1),2),p=f[0],x=f[1],b=(0,eT.NL)(),y=(0,eC.D)({mutationFn:function(){return L.ZP.postActivateReferralInvite(n.id)},onSettled:function(){b.invalidateQueries({queryKey:["referralInvites"]}),h(!1)},onError:(0,o._)(function(){return(0,u.Jh)(this,function(e){return ei.m.danger(r.formatMessage(eA.activateReferralError)),[2]})}),onSuccess:function(e){h(!1);var t,n,o=e.invite_code;navigator.clipboard.writeText(eS(null!=o?o:"")),x(!0),null===(t=s.current)||void 0===t||t.select(),ei.m.success(r.formatMessage(eA.copiedReferralToastMessage,{referralInviteCode:o}),{duration:3,hasCloseButton:!0}),null===(n=a.current)||void 0===n||n.scrollTo(0,0)}}).mutateAsync,k=(t=(0,o._)(function(e){var t;return(0,u.Jh)(this,function(n){switch(n.label){case 0:switch(e.status){case"created":return[3,1];case"activated":return[3,3];case"claimed":return[3,4];case"subscription_granted":return[3,5]}return[3,6];case 1:return h(!0),ej.m9.logEvent("chatgpt_referral_invite_link_activated"),g.A.logEvent(v.M.chatgptReferralInviteLinkActivated),[4,y()];case 2:return n.sent(),[3,7];case 3:return ej.m9.logEvent("chatgpt_referral_invite_link_copied"),g.A.logEvent(v.M.chatgptReferralInviteLinkCopied),navigator.clipboard.writeText(eS(null!==(t=e.code_token)&&void 0!==t?t:"")),x(!0),ei.m.success(r.formatMessage(eA.copiedReferralToastMessage,{referralInviteCode:e.code_token}),{duration:3,hasCloseButton:!0}),[3,7];case 4:case 5:case 6:return[3,7];case 7:return[2]}})}),function(e){return t.apply(this,arguments)}),M="".concat(window.location.host,"/invite/");return(0,m.jsxs)("tr",{children:[(0,m.jsxs)("td",{className:"relative w-full whitespace-nowrap py-1.5 pl-1 pr-3 text-sm text-gray-900 dark:text-white",children:[(0,m.jsx)("input",{ref:s,name:"referral-code",className:"block w-full border-0 bg-transparent py-1.5 pl-2 text-gray-900 shadow-none ring-0 ring-inset placeholder:text-gray-600 focus:ring-0 focus:ring-inset dark:text-white placeholder:dark:text-white sm:text-sm",disabled:"activated"!=n.status,value:"created"==n.status||"subscription_granted"==n.status?"":eS(n.code_token)}),(0,m.jsxs)("span",{className:"absolute top-3 flex items-center pl-2 text-gray-700  dark:text-white",children:["created"==n.status&&(0,m.jsxs)("span",{children:[M,(0,m.jsx)("span",{className:"select-none text-gray-400  dark:text-gray-300",children:"•••••••"})]}),"subscription_granted"==n.status&&(0,m.jsx)("span",{className:"select-none line-through opacity-25",children:eS(n.code_token)})]})]}),(0,m.jsx)("td",{className:"relative whitespace-nowrap py-1.5 pl-3 pr-2 text-right text-sm font-medium sm:pr-2",children:(0,m.jsx)(W.z,{disabled:c||"claimed"==n.status||"subscription_granted"==n.status,loading:c,as:"button",type:"button",onClick:function(){return k(n)},color:"created"==n.status?"primary":"light",className:(0,Y.default)("w-20 rounded-sm py-1 text-sm",{"bg-brand-green/20 text-green-700 hover:bg-brand-green/30 dark:bg-brand-green/50 dark:text-green-100 dark:hover:bg-brand-green/40":"activated"==n.status,"!bg-gray-200 ":"subscription_granted"==n.status}),children:(0,m.jsx)("span",{className:"flex flex-row items-center",children:"created"==n.status?(0,m.jsx)(S.Z,(0,i._)({},eA.referralActivate)):"activated"==n.status?p?(0,m.jsx)(S.Z,(0,i._)({},eA.referralCopied)):(0,m.jsx)(S.Z,(0,i._)({},eA.referralCopy)):"claimed"==n.status?(0,m.jsx)(S.Z,(0,i._)({},eA.referralClaimed)):"subscription_granted"==n.status?(0,m.jsx)(S.Z,(0,i._)({},eA.referralClaimed)):null})})})]})},eA=(0,N.vU)({modalTitle:{id:"InviteReferralModal.modalTitle",description:"Description for the invite referral modal",defaultMessage:"Refer a friend"},inviteFormTitle:{id:"InviteReferralModal.inviteFormTitle",description:"Title for the invite referral form",defaultMessage:"Emails"},invitePlaceholder:{id:"InviteReferralModal.invitePlaceholder",description:"List of placeholder emails for the invite referral form",defaultMessage:"friend@openai.com, friend2@openai.com..."},referralActivate:{id:"InviteReferralModal.referralActivate",description:"Button label for activating a referral code",defaultMessage:"Copy"},referralCopy:{id:"InviteReferralModal.referralCopy",description:"Button label for copying a referral code",defaultMessage:"Copy"},referralCopied:{id:"InviteReferralModal.referralCopied",description:"Button label for when a referral code is copied",defaultMessage:"Copied"},referralClaimed:{id:"InviteReferralModal.referralClaimed",description:"Disabled state for claimed referral code",defaultMessage:"Claimed"},inviteDescription:{id:"InviteReferralModal.inviteDescription",description:"Description text for the invite referral modal",defaultMessage:"Share ChatGPT Plus with your friends!"},inviteDescriptionFollowUp:{id:"InviteReferralModal.inviteDescriptionFollowUp",description:"Description follow up text for the invite referral modal",defaultMessage:"Activate and copy the referral links below to share ChatGPT Plus with your friends, giving them access to a free trial!"},inviteRemaining:{id:"InviteReferralModal.inviteRemaining",description:"Description of invites remaining for the invite referral modal",defaultMessage:"{remainingInviteCount} available"},usersInvited:{id:"InviteReferralModal.usersInvited",description:"Description of users invited for the invite referral modal",defaultMessage:"<showcaseValue>{usersInviteCount}</showcaseValue><description>users invited</description>"},referralCodeLabel:{id:"InviteReferralModal.referralCodeLabel",description:"Label for the referral code input field",defaultMessage:"Links"},sendInviteCta:{id:"InviteReferralModal.sendInviteCta",description:"Button text for the invite referral modal",defaultMessage:"Send invites"},clickToActivateString:{id:"InviteReferralModal.clickToActivateString",description:"Text for the activate referral invite action referral modal",defaultMessage:"chat.openai.com/invite/<codeStyle>•••••••</codeStyle>"},clickToCopyString:{id:"InviteReferralModal.clickToCopyString",description:"Text for clicking to copy invite action referral modal",defaultMessage:"Click to copy"},copiedReferralToastMessage:{id:"InviteReferralModal.copiedReferralToastMessage",description:"Toast text to display when copying a referral invite code",defaultMessage:"Your referral link {referralInviteCode} has been copied to your clipboard. Share it with your friends!"},activateReferralError:{id:"InviteReferralModal.activateReferralError",description:"Text to display when activating a referral invite fails",defaultMessage:"Failed to accept referral invite. Please try again."}}),eP=n(69789),eL=n(94486),eZ=n(43178),eq=n(17314);function eB(){var e,t,n,a,r,o,s=(0,D.Z)(),l=(t=(e=(0,eL.S)()).isLoggedInWithMfa,n=e.isUsernamePassword,a=e.setupMfa,o=(r=(0,eq.p0)()).filter(function(e){return!("none"===e.manifest.auth.type||"service_http"===e.manifest.auth.type)}),(t||!n)&&(o=[]),{disablePluginsThatWeCantUse:function(){var e=r.filter(function(e){return"none"===e.manifest.auth.type||"service_http"===e.manifest.auth.type});(0,eq.dT)(e.map(function(e){return e.id}))},pluginsWeCantUse:o,setupMfa:a}),d=l.disablePluginsThatWeCantUse,c=l.pluginsWeCantUse,u=l.setupMfa,h=(0,C.useCallback)(function(){d()},[d]);return 0===c.length?null:(0,m.jsx)(er.Z,{isOpen:!0,onClose:h,title:(0,m.jsx)(S.Z,(0,i._)({},eE.title)),primaryButton:(0,m.jsx)(ea.ZP.Button,{onClick:u,title:s.formatMessage(eE.primaryButtonTitle),color:"primary"}),secondaryButton:(0,m.jsx)(ea.ZP.Button,{onClick:d,title:s.formatMessage(eE.secondaryButtonTitle)}),type:"danger",children:(0,m.jsx)("div",{className:"flex flex-col gap-2 py-4",children:c.map(function(e){return(0,m.jsx)("div",{className:"w-full",children:(0,m.jsx)(eZ.Z,{plugin:e})},e.id)})})})}var eE=(0,N.vU)({title:{id:"RequireMfaForAuthPluginsModal.title",description:"Title for the Require MFA for Auth Plugins modal",defaultMessage:"Some of your plugins require two-factor authentication."},primaryButtonTitle:{id:"RequireMfaForAuthPluginsModal.primaryButtonTitle",description:"Title for the primary button to set up two-factor authentication",defaultMessage:"Setup two-factor authentication"},secondaryButtonTitle:{id:"RequireMfaForAuthPluginsModal.secondaryButtonTitle",description:"Title for the secondary button to disable plugins",defaultMessage:"Turn off the plugins"}});function eF(e){var t=e.isOpen,n=e.onClose,a=(0,C.useCallback)(function(){g.A.logEvent(v.M.closeAccountPaymentModal),n()},[n]);return(0,m.jsx)(ea.ZP.Root,{isOpen:t,onClose:a,shouldIgnoreClickOutside:!0,children:(0,m.jsx)(ea.ZP.Overlay,{children:(0,m.jsx)(ea.ZP.Content,{className:"focus-none !bg-transparent !shadow-none outline-none md:w-[672px] lg:w-[896px] xl:w-[1024px]",children:(0,m.jsx)("div",{className:"focus-none flex h-full flex-col items-center justify-start outline-none",children:(0,m.jsx)("div",{className:"relative w-full",children:(0,m.jsxs)("div",{className:"flex grow flex-col items-start justify-center overflow-hidden rounded-md border bg-white shadow-md dark:border-gray-700 dark:bg-gray-900",children:[(0,m.jsxs)("div",{className:"flex w-full flex-row items-center justify-between border-b px-4 py-3 dark:border-gray-700",children:[(0,m.jsx)("span",{className:"text-base font-semibold sm:text-base",children:(0,m.jsx)(S.Z,(0,i._)({},eU.modalTitle))}),(0,m.jsx)("button",{className:"text-gray-700 opacity-50 transition hover:opacity-75 dark:text-white",onClick:a,children:(0,m.jsx)(j.q5L,{className:"h-6 w-6"})})]}),(0,m.jsx)("div",{className:"grid w-full",children:(0,m.jsx)("div",{className:"relative w-full ",children:(0,m.jsx)("div",{id:"embedded-checkout-modal"})})})]})})})})})})}var eU=(0,N.vU)({modalTitle:{id:"EmbeddedPaymentModal.modalTitle",description:"Title for the payment page modal",defaultMessage:"Your plan"}}),eO=n(59517),ez=n(26003),eQ=n(6013),eG=n(38574),eW=n(43477),eV=n(78103),eH=(0,C.createContext)(),eJ=function(e){return(0,eV.oR)((0,C.useContext)(eH),e)},eY=n(93028),eK=n(43153);function e$(e){return e.some(function(e){return e.messages.some(function(e){var t,n,a,r;return(null==(a=null===(t=e.message.metadata)||void 0===t?void 0:t.aggregate_result)?void 0:null===(n=a.messages)||void 0===n?void 0:n.some(eK.O1))||("parts"in(r=e.message.content)?r.parts.join(""):"").includes("sandbox:")})})}var eX=function(e){var t=e.children,n=e.color,a=void 0===n?"yellow":n,r=e.icon;return(0,m.jsxs)("div",{className:(0,Y.default)("mb-4 flex items-start justify-start gap-2.5 rounded-md p-4 last:mb-0",{"bg-yellow-300 text-[#756B5C]":"yellow"===a,"bg-gray-50 text-gray-800 dark:bg-[#444654] dark:text-gray-100":"gray"===a}),children:[null!=r&&(0,m.jsx)(r,{className:"icon-sm mt-1 flex-shrink-0"}),t]})},e0=n(70737),e1=n(97296),e2=n(40803),e4=n(95552),e3=n.n(e4),e5=n(35265),e6=n(15461),e9=n(67568),e7=n(10499),e8=n(49519);function te(){var e=(0,c._)(["cursor-pointer absolute z-10 rounded-full bg-clip-padding border text-gray-600 dark:border-white/10 dark:bg-white/10 dark:text-gray-200 right-1/2 border-black/10 bg-token-surface-primary bottom-5"]);return te=function(){return e},e}function tt(){var e=(0,c._)(["\n  ","\n  dark:hover:text-gray-200 hover:text-gray-950\n"]);return tt=function(){return e},e}function tn(){var e=(0,c._)(["mx-auto mt-2 inline-flex rounded-xl border border-gray-100 dark:border-gray-700\n","\n"]);return tn=function(){return e},e}var ta=(0,N.vU)({advancedDataAnalysisSupportDisclaimer:{id:"sharedConversation.advancedDataAnalysisSupportDisclaimer",defaultMessage:"This chat contains files or images produced by Advanced Data Analysis which are not yet visible in Shared Chats.",description:"Disclaimer about our lack of support for Advanced Data Analysis inline images and file downloads with shared links"},personalizedDataDisclaimer:{id:"sharedConversation.personalizedDataDisclaimer",defaultMessage:"This conversation may reflect the link creator’s personalized data, which isn’t shared and can meaningfully change how the model responds.",description:"Disclaimer about the creator's personalized data (ex: custom instructions, memory) not being part of the shared conversation"},ratingThanks:{id:"rating.thanks",defaultMessage:"Thanks for your feedback!",description:"Thank the user for their rating"},ratingInstructions:{id:"rating.instructions",defaultMessage:"Is this conversation helpful so far?",description:"Ask the user for their rating of the conversation so far"}});function tr(e){var t=e.clientThreadId,n=(0,q.qA)(t),a=(0,q.je)(t),r=(0,q.qN)(function(e){return q.iN.getThreadCreateTime(t,e)}),o=(0,q.oq)(t),i=(0,q.JI)(t,o),s=(0,C.useMemo)(function(){return e$(i)},[i]),l=(0,q.aS)(t),d=(0,q.eY)(t);return(0,m.jsxs)("div",{className:"border-b border-gray-100 pb-4 pt-3 sm:mb-2 sm:pb-6 sm:pt-8",children:[(0,m.jsx)("h1",{className:"text-3xl font-semibold leading-tight text-gray-700 dark:text-gray-100 sm:text-4xl",children:n}),(null!=a||null!=r)&&(0,m.jsxs)("div",{className:"pt-3 text-base text-gray-400 sm:pt-4",children:[null!=a&&(0,m.jsx)("span",{children:a}),null!=a&&null!=r&&(0,m.jsx)("span",{className:"px-2",children:"•"}),null!=r&&(0,m.jsx)(N.Ji,{value:r,month:"long",year:"numeric",day:"numeric"})]}),(0,m.jsx)(to,{shouldShowCodeInterpreterDisclaimer:s,shouldShowPersonalizedDataDisclaimer:l||d})]})}var to=function(e){var t=e.shouldShowCodeInterpreterDisclaimer,n=e.shouldShowPersonalizedDataDisclaimer;return(0,m.jsxs)(m.Fragment,{children:[t&&(0,m.jsx)("div",{className:"mt-4",children:(0,m.jsx)(eX,{icon:j.H33,color:"gray",children:(0,m.jsx)(S.Z,(0,i._)({},ta.advancedDataAnalysisSupportDisclaimer))})}),n&&(0,m.jsx)("div",{className:"mt-4",children:(0,m.jsx)(eX,{icon:j.H33,color:"gray",children:(0,m.jsx)(S.Z,(0,i._)({},ta.personalizedDataDisclaimer))})})]})};function ti(e){var t=e.onChangeItemInView,n=e.onRequestMoreCompletions,a=e.onChangeRating,r=e.onRequestCompletion,o=e.clientThreadId,i=e.conversationLeafId,s=e.currentThreadModel,l=e.inlineEmbeddedDisplay,c=e.initiallyHighlightedMessageId,u=e.hideHeader,h=null!==(0,C.useContext)(U.gB),f=(0,e2.useScrollToBottom)(),p=(0,d._)((0,e2.useSticky)(),1)[0],g=(0,F.$T)(),v=(0,e7.Xy)(s,o),x=(0,e8.Ri)(v.id),b=(0,q.U0)(o,i),y=(0,J._)(Array(b).keys()).map(function(e){return(0,m.jsx)(en.ZP,{isFinalTurn:e===b-1,turnIndex:e,clientThreadId:o,conversationLeafId:i,onChangeItemInView:t,onChangeRating:a,onRequestMoreCompletions:n,onRequestCompletion:r,currentModelId:v.id,showInlineEmbeddedDisplay:l,initiallyHighlightedMessageId:c,avatarColor:null==x?void 0:x.backgroundColor},e)});return(0,m.jsxs)("div",{className:"flex flex-col pb-9 text-sm",children:[!u&&(h||!g)&&!l&&(0,m.jsx)(e6.B,{currentModelConfig:v,clientThreadId:o}),h&&!l&&(0,m.jsx)("div",{className:"mx-auto w-full p-4 md:max-w-2xl md:px-0 lg:max-w-[38rem] xl:max-w-3xl",children:(0,m.jsx)(tr,{clientThreadId:o})}),y,(0,m.jsx)(tu,{clientThreadId:o,conversationLeafId:i}),!p&&!l&&(0,m.jsx)(ts,{onClick:f,children:(0,m.jsx)(e5.Hg,{className:"m-1 text-black dark:text-white"})})]})}var ts=R.Z.button(te()),tl=R.Z.button(tt(),function(e){return e.$selected?"text-gray-950 dark:text-gray-100":"text-gray-400 dark:text-gray-400"}),td=R.Z.div(tn(),function(e){return e.$padded&&"py-3 px-4"}),tc=[1,2,3,4];function tu(e){var t=e.clientThreadId,n=e.conversationLeafId,a=(0,F.ec)(F.F_.isBusinessWorkspace),r=(0,q.XK)(t),o=(0,e9.WA)(t),s=(0,C.useMemo)(function(){if(!r)return -1;var e=e3()(r);return e()>.5?-1:tc[Math.floor(e()*tc.length)]},[r]),l=(0,q.JI)(t,n),c=l[l.length-1],u=(0,C.useMemo)(function(){return ee.Cv.getRequestIdFromConversationTurn(c)},[c]),h=(0,V.Yk)(u),f=(0,d._)((0,C.useState)(null),2),p=f[0],g=f[1],v=(0,d._)((0,C.useState)(!1),2),x=v[0],b=v[1],y=(0,d._)((0,C.useState)(!1),2),k=y[0],M=y[1],w=(0,d._)((0,C.useState)(!1),2),T=w[0],j=w[1],_=(0,C.useMemo)(function(){return(0,eb.debounce)(function(e,t){r&&e&&L.ZP.submitConversationRating({conversation_id:r,message_id:e,rating:t,shown_at_assistant_turn:s}),b(!0),setTimeout(function(){M(!0)},1500)},2e3)},[r,s]),N=function(e){var t,n,a=null===(t=null===(n=(0,eb.last)(l))||void 0===n?void 0:n.messages[0])||void 0===t?void 0:t.message.id;g(e),_(a,e)},D=l.filter(function(e){return e.role===P.uU.Assistant}).length,R=(null==c?void 0:c.role)===P.uU.Assistant;return D!==s||h||!R||a||o.kind!==P.OL.PrimaryAssistant||T?null:(0,m.jsxs)("div",{className:"mx-auto",children:[(0,m.jsx)(e0.M,{children:x&&!k&&(0,m.jsx)(e1.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:(0,m.jsx)(td,{$padded:!0,children:(0,m.jsx)("span",{className:"text-sm text-token-text-tertiary",children:(0,m.jsx)(S.Z,(0,i._)({},ta.ratingThanks))})})},"submitted")}),!x&&(0,m.jsx)(e1.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},children:(0,m.jsxs)(td,{$padded:!1,children:[(0,m.jsxs)("div",{className:"flex items-center justify-center gap-4 px-4 py-3 text-sm text-token-text-tertiary",children:[(0,m.jsx)(S.Z,(0,i._)({},ta.ratingInstructions)),(0,m.jsxs)("div",{className:"flex items-center gap-5",children:[(0,m.jsx)(tl,{$selected:"thumbsUp"===p,onClick:function(){return N("thumbsUp")},children:(0,m.jsx)(e5.ib,{className:"icon-md"})}),(0,m.jsx)(tl,{$selected:"thumbsDown"===p,onClick:function(){return N("thumbsDown")},children:(0,m.jsx)(e5.Q7,{className:"icon-md"})})]})]}),(0,m.jsx)("div",{className:"w-px flex-1 self-stretch bg-gray-100 dark:bg-gray-700"}),(0,m.jsx)(tl,{className:"p-3",$selected:!1,onClick:function(){return j(!0)},children:(0,m.jsx)(I.bjh,{className:"icon-sm"})})]})},"rating")]})}function tm(){var e=(0,c._)(["relative h-full w-full transition-width flex flex-col overflow-hidden items-stretch"]);return tm=function(){return e},e}function th(){var e=(0,c._)(["grow flex-1 overflow-hidden"]);return th=function(){return e},e}function tf(){var e=(0,c._)(["w-full mb-4 shadow-[0_2px_12px_0px_rgba(0,0,0,0.08)] dark:bg-gray-800/90 rounded-lg border border-gray-100 dark:border-gray-700 overflow-hidden bg-gray-50"]);return tf=function(){return e},e}function tp(){var e=(0,c._)(["flex p-4 bg-white dark:bg-gray-800/90 border-t border-gray-100 dark:border-gray-700 rounded-b-lg w-full h-full\n","\n"]);return tp=function(){return e},e}function tg(){var e=(0,c._)(["flex w-full items-center justify-left gap-2 min-h-[1.5rem]"]);return tg=function(){return e},e}function tv(){var e=(0,c._)(["border-none focus:ring-gray-200 dark:focus:ring-gray-600 bg-transparent py-0.5 -my-0.5 pl-1 -ml-1 w-full"]);return tv=function(){return e},e}function tx(){var e=(0,c._)(["flex-none h-full mt-auto mb-auto"]);return tx=function(){return e},e}var tb=(0,N.vU)({sharingModalTitle:{id:"thread.sharingModal.title",defaultMessage:"Share link to Chat",description:"Title of sharing feature in the title of the sharing modal"},sharingModalDescription:{id:"sharingModal.description",defaultMessage:"Messages you send after creating your link won't be shared. Anyone with the URL will be able to view the shared chat.",description:"Description of sharing feature in the first paragraph of the sharing modal"},sharingModalBizDescription:{id:"sharingModal.bizDescription.1",defaultMessage:"Only members of your workspace with the URL will see the latest messages sent in this conversation. Files you attach to the conversation will not be shared, but any file contents referenced in messages will continue to be visible.",description:"Description of sharing feature in the first paragraph of the sharing modal"},existingShareDescription:{id:"sharingModal.exisitingDescription",defaultMessage:"You have shared this chat <existingLink>before</existingLink>. If you want to update the shared chat content, <deleteLink>delete this link</deleteLink> and create a new shared link.",description:"Description in sharing modal when viewing an existing link"},sharingModalMoreInfo:{id:"thread.sharingModal.moreInfo",defaultMessage:"More Info",description:"Link to a helpdesk article with more information about the sharing modal"},moderationBlocked:{id:"sharingModal.moderationBlocked",defaultMessage:"This shared link has been disabled by moderation.",description:"Error message in sharing modal when shared link has been moderated."},confirmCloseWithChanges:{id:"thread.sharingModal.confirmCloseWithChanges",defaultMessage:"You have unsaved changes. Do you want to continue?",description:"Confirmation message when closing share modal with changes"},confirmDeleteLink:{id:"sharingModal.confirmDeleteLink",defaultMessage:"Are you sure you want to delete the share link?",description:"Confirmation message when deleting share link"},advancedDataAnalysisSupportDisclaimer:{id:"sharingModal.advancedDataAnalysisSupportDisclaimer",defaultMessage:"Recipients won’t be able to view Advanced Data Analysis images or download files.",description:"Disclaimer about our lack of support for Advanced Data Analysis inline images and file downloads with shared links"},personalizedDataDisclaimer:{id:"sharingModal.personalizedDataDisclaimer",defaultMessage:"Any personalized data not present in the conversation won’t be shared with viewers (ex: custom instructions).",description:"Disclaimer about our policy to not share personalized data (ex: custom instructions, memory)"},copied:{id:"thread.sharingModal.copied",defaultMessage:"Copied!",description:"Status message after successfully copying the shared link"},copying:{id:"thread.sharingModal.copying",defaultMessage:"Copying...",description:"Status message while copying the shared link"},updateAndCopyLink:{id:"thread.sharingModal.updateAndCopyLink",defaultMessage:"Update and Copy Link",description:"Button text to update and copy the shared link"},shareYourName:{id:"sharingModal.shareYourName",defaultMessage:"Share your name",description:"Button text to change sharing to show the user's name"},shareAnonymously:{id:"sharingModal.shareAnonymously",defaultMessage:"Share anonymously",description:"Button text to change sharing to be anonymous"},deleteLink:{id:"sharingModal.deleteLink",defaultMessage:"Delete Link",description:"Button text to delete the share link"},failedToCopyLink:{id:"thread.sharingModal.failedToCopyLink",defaultMessage:"Failed to copy link to clipboard",description:"Error message when failing to copy link to clipboard"},copyLink:{id:"thread.sharingModal.copyLink",defaultMessage:"Copy Link",description:"Button text to copy the shared link"},copiedSharedConversationURL:{id:"thread.sharingModal.copiedSharedConversationURL",defaultMessage:"Copied shared conversation URL to clipboard!",description:"Success message when shared conversation URL is copied"},failedToDeleteSharedLink:{id:"thread.sharingModal.failedToDeleteSharedLink",defaultMessage:"Failed to delete shared link",description:"Error message when failing to delete shared link"}});function ty(e){var t=e.serverThreadId,n=(0,q.oq)(t),a=(0,d._)((0,C.useState)(function(){return(0,eW.Z)(function(e,t){return{title:void 0,highlightedMessageId:void 0,initiallyHighlightedMessageId:void 0,currentNodeId:void 0,shareLinkId:void 0,shareLinkUrl:void 0,isPublic:!1,isDeleted:!1,isAnonymous:!0,linkAlreadyExisted:!1,linkError:void 0,moderationState:void 0}})}),1)[0],r=!(0,V.B$)()&&"root"!==n,o=(0,C.useRef)(!1);return(0,C.useEffect)(function(){if(r&&!o.current){o.current=!0;var e=q.tQ.getThreadCurrentLeafId(t),n=q.tQ.getTree(t).getMessageId(e);L.ZP.createShareLink({current_node_id:n,conversation_id:t,is_anonymous:!0}).then(function(e){a.setState({shareLinkId:e.share_id,shareLinkUrl:e.share_url,isPublic:e.is_public,isDeleted:!e.is_visible,title:e.title,highlightedMessageId:e.highlighted_message_id,initiallyHighlightedMessageId:e.highlighted_message_id,currentNodeId:e.current_node_id,linkAlreadyExisted:e.already_exists,isAnonymous:e.is_anonymous,moderationState:e.moderation_state})}).catch(function(e){e instanceof eY.Q0&&"string"==typeof e.message?a.setState({linkError:e.message}):(ei.m.danger("Failed to copy link to clipboard - could not create link"),E.vm.closeSharingModal())})}},[r]),(0,m.jsx)(eH.Provider,{value:a,children:(0,m.jsx)(tM,(0,i._)({},e))})}function tk(e){return!0===e.has_been_auto_blocked||!0===e.has_been_auto_moderated||!0===e.has_been_blocked}function tM(e){var t,n,a,r,l=e.serverThreadId,c=e.currentThreadModel,h=function(){(!ec||window.confirm(f.formatMessage(tb.confirmCloseWithChanges)))&&E.vm.closeSharingModal()},f=(0,D.Z)(),p=(0,C.useRef)(null),g=(0,d._)((0,C.useState)(!1),2),v=g[0],x=g[1],b=(0,d._)((0,C.useState)(!1),2),y=b[0],k=b[1],M=(0,d._)((0,C.useState)(!1),2),w=M[0],T=M[1],I=(0,C.useContext)(eH),R=eJ(function(e){return e.title}),A=eJ(function(e){return e.shareLinkId}),P=eJ(function(e){return e.shareLinkUrl}),Z=eJ(function(e){return e.isAnonymous}),B=eJ(function(e){return e.initiallyHighlightedMessageId}),O=eJ(function(e){return e.currentNodeId}),z=eJ(function(e){return e.isPublic}),Q=eJ(function(e){return e.linkAlreadyExisted})&&z,G=eJ(function(e){return e.linkError}),V=eJ(function(e){return e.moderationState}),H=null!=V&&tk(V),J=(0,F.ec)(F.F_.isBusinessWorkspace),K=(0,q.oq)(l),X=(0,C.useRef)(),ee=(0,C.useRef)();(0,C.useEffect)(function(){Q&&(X.current=R,ee.current=Z)},[Q]);var et=(0,F.aF)(),en=(0,q.JI)(l,null!=O?O:K),eo=(0,C.useMemo)(function(){return e$(en)},[en]),es=(0,q.aS)(l),el=(0,q.eY)(l),ed=(t=(0,o._)(function(e,t){var n,a,r,o,i,s,l;return(0,u.Jh)(this,function(d){switch(d.label){case 0:k(!0),a=(n=I.getState()).highlightedMessageId,r=n.title,o=n.isDeleted,i=n.isAnonymous;try{(0,eG.S)(t)}catch(e){return ei.m.warning(f.formatMessage(tb.failedToCopyLink)),k(!1),[2]}d.label=1;case 1:return d.trys.push([1,3,4,5]),[4,L.ZP.updateShareLink({share_id:e,highlighted_message_id:a,title:null!=r?r:void 0,is_public:!o,is_visible:!o,is_anonymous:i})];case 2:if(tk(s=d.sent().moderation_state))return I.setState({moderationState:s}),[2];return I.setState({isPublic:!0,moderationState:s}),T(!0),setTimeout(function(){E.vm.closeSharingModal(),ei.m.success(f.formatMessage(tb.copiedSharedConversationURL))},500),[3,5];case 3:return(l=d.sent())instanceof eY.Q0&&"string"==typeof l.message&&I.setState({linkError:l.message}),[3,5];case 4:return k(!1),[7];case 5:return[2]}})}),function(e,n){return t.apply(this,arguments)}),ec=Q&&(R!==X.current||Z!==ee.current),eu=(0,m.jsxs)(ea.ZP.Button,{onClick:function(){return ed(A,P)},color:"primary",disabled:y||w||null==A||null==P||null!=G||H,children:[w?(0,m.jsx)(j.LSm,{className:"icon-sm"}):y?(0,m.jsx)(eI.Z,{}):(0,m.jsx)(j.XKb,{className:"icon-sm"}),w?(0,m.jsx)(S.Z,(0,i._)({},tb.copied)):y?(0,m.jsx)(S.Z,(0,i._)({},tb.copying)):ec?(0,m.jsx)(S.Z,(0,i._)({},tb.updateAndCopyLink)):(0,m.jsx)(S.Z,(0,i._)({},tb.copyLink))]}),em=(0,C.useCallback)(function(e){var t;null==e||e.preventDefault(),I.setState({title:null===(t=p.current)||void 0===t?void 0:t.value}),x(!1)},[I]),eh=(0,C.useCallback)(function(e){"Enter"===e.key&&em()},[em]),ef=(n=(0,o._)(function(){return(0,u.Jh)(this,function(e){switch(e.label){case 0:return[4,L.ZP.deleteShareLink({share_id:I.getState().shareLinkId}).catch(function(e){ei.m.danger(f.formatMessage(tb.failedToDeleteSharedLink))}).then(function(){E.vm.closeSharingModal()})];case 1:return e.sent(),[2]}})}),function(){return n.apply(this,arguments)}),ep=(a=(0,o._)(function(){return(0,u.Jh)(this,function(e){return I.setState({isAnonymous:!0}),q.qN.setState(function(e){e.threads[l].initialThreadData.authorName=void 0}),[2]})}),function(){return a.apply(this,arguments)}),eg=(r=(0,o._)(function(){return(0,u.Jh)(this,function(e){return I.setState({isAnonymous:!1}),q.qN.setState(function(e){e.threads[l].initialThreadData.authorName=null==et?void 0:et.name}),[2]})}),function(){return r.apply(this,arguments)}),ev=(0,m.jsxs)(t_,{$active:v,children:[(0,m.jsxs)("div",{className:"flex-1 pr-1",children:[void 0!==R?v?(0,m.jsx)(tN,{ref:p,type:"text",defaultValue:null!=R?R:"",autoFocus:!0,onKeyDown:eh,onBlur:em}):(0,m.jsxs)(tI,{onDoubleClick:function(){return x(!0)},children:[R,v||null==R||Q?null:(0,m.jsx)("button",{onClick:function(){return x(!0)},className:"text-gray-500",children:(0,m.jsx)(j.Nte,{className:"icon-sm"})})]}):(0,m.jsx)("div",{className:"h-6"}),(0,m.jsxs)("div",{className:"mt-1 text-gray-500",children:[!Z&&(0,m.jsx)("span",{children:"".concat(null==et?void 0:et.name," \xb7 ")}),(0,m.jsx)(N.Ji,{value:new Date,month:"long",day:"numeric",year:"numeric"})]})]}),(0,m.jsx)(tS,{children:(0,m.jsxs)(eQ.fC,{children:[(0,m.jsx)(eQ.xz,{asChild:!0,children:(0,m.jsx)(W.z,{color:"neutral",className:"mb-auto mt-auto",children:(0,m.jsx)(_.JEI,{})})}),(0,m.jsx)(eQ.h_,{children:(0,m.jsxs)(eQ.VY,{className:"PopoverContent rounded-sm bg-white p-2 pb-0.5 shadow-xl dark:bg-gray-800/90",side:"top",align:"end",children:[Z&&(0,m.jsx)(W.z,{color:"neutral",className:"mb-2 flex w-full border-0",onClick:eg,children:(0,m.jsxs)("div",{className:"flex w-full items-start",children:[(0,m.jsx)(j.fzv,{className:"icon-sm float-left mb-auto mr-4 mt-auto"}),(0,m.jsx)("div",{children:(0,m.jsx)(S.Z,(0,i._)({},tb.shareYourName))})]})}),!Z&&(0,m.jsx)(W.z,{color:"neutral",className:"mb-2 flex w-full border-0",onClick:ep,children:(0,m.jsxs)("div",{className:"flex w-full items-start",children:[(0,m.jsx)(j.fzv,{className:"icon-sm float-left mb-auto mr-4 mt-auto"}),(0,m.jsx)("div",{children:(0,m.jsx)(S.Z,(0,i._)({},tb.shareAnonymously))})]})}),Q&&(0,m.jsx)(W.z,{color:"neutral",className:"mb-2 flex w-full border-0",onClick:ef,children:(0,m.jsxs)("div",{className:"flex w-full items-start",children:[(0,m.jsx)(j.Ybf,{className:"icon-sm float-left mb-auto mr-4 mt-auto"}),(0,m.jsx)("div",{children:(0,m.jsx)(S.Z,(0,i._)({},tb.deleteLink))})]})})]})})]})})]}),ex=G;return null==ex&&((null==V?void 0:V.has_been_auto_blocked)||(null==V?void 0:V.has_been_auto_moderated)||(null==V?void 0:V.has_been_blocked))&&(ex=(0,m.jsx)(S.Z,(0,i._)({},tb.moderationBlocked))),(0,m.jsxs)(er.Z,{isOpen:!0,onClose:function(){h()},size:"custom",className:"max-w-[550px]",type:"success",title:f.formatMessage(tb.sharingModalTitle),closeButton:(0,m.jsx)(ea.ZP.CloseButton,{onClose:function(){h()}}),children:[null!=ex&&(0,m.jsx)("div",{className:"mb-4 rounded-md bg-red-500 p-4 text-white",children:ex}),(0,m.jsx)("div",{className:(0,Y.default)("w-full"),children:(0,m.jsx)("p",{className:(0,Y.default)("mb-6 text-gray-500"),children:Q?(0,m.jsx)(S.Z,(0,s._)((0,i._)({},tb.existingShareDescription),{values:{existingLink:function(e){return(0,m.jsx)("a",{href:P,target:"_blank",rel:"noreferrer",className:"underline",children:e})},deleteLink:function(e){return(0,m.jsx)("a",{href:"#",onClick:function(e){e.preventDefault(),window.confirm(f.formatMessage(tb.confirmDeleteLink))&&ef()},className:"underline",children:e})}}})):(0,m.jsx)(S.Z,(0,i._)({},J?tb.sharingModalBizDescription:tb.sharingModalDescription))})}),(0,m.jsx)(tw,{shouldShowCodeInterpreterDisclaimer:eo,shouldShowPersonalizedDataDisclaimer:es||el}),(0,m.jsx)(tj,{children:(0,m.jsx)("div",{className:"flex h-full max-w-full flex-1 flex-col",children:(0,m.jsx)(tT,{children:(0,m.jsxs)(tC,{children:[(0,m.jsx)(ez.f,{ratio:1.9,className:"overflow-auto bg-white dark:bg-gray-800",children:null!=O?(0,m.jsx)(U.gB.Provider,{value:{serverSharedThreadId:null},children:(0,m.jsx)(ti,{onChangeItemInView:$(),onRequestMoreCompletions:$(),onChangeRating:$(),onRequestCompletion:$(),clientThreadId:l,conversationLeafId:O,currentThreadModel:c,inlineEmbeddedDisplay:!0,initiallyHighlightedMessageId:B})}):(0,m.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,m.jsx)(eI.Z,{className:"text-gray-400 dark:text-gray-500"})})}),ev]})})})}),(0,m.jsx)(ea.ZP.Actions,{isSpacedBetween:!0,primaryButton:eu,secondaryButton:(0,m.jsx)("div",{children:(0,m.jsxs)("a",{href:J?"https://help.openai.com/en/articles/8474715-chatgpt-enterprise-shared-links-faq":"https://help.openai.com/en/articles/7925741-chatgpt-shared-links-faq",className:"flex items-center gap-2 text-gray-500 hover:text-gray-600 dark:hover:text-gray-400",target:"_blank",rel:"noreferrer",children:[f.formatMessage(tb.sharingModalMoreInfo),(0,m.jsx)(j.AlO,{className:"icon-sm"})]})})})]})}var tw=function(e){var t=e.shouldShowCodeInterpreterDisclaimer,n=e.shouldShowPersonalizedDataDisclaimer;return(0,m.jsxs)(m.Fragment,{children:[t&&(0,m.jsx)(eX,{icon:j.H33,children:(0,m.jsx)(S.Z,(0,i._)({},tb.advancedDataAnalysisSupportDisclaimer))}),n&&(0,m.jsxs)("p",{className:"mb-6 flex flex-row gap-2.5 text-gray-500",children:[(0,m.jsx)(j.H33,{className:"icon-sm mt-1 flex-shrink-0"}),(0,m.jsx)(S.Z,(0,i._)({},tb.personalizedDataDisclaimer))]})]})},tT=R.Z.main(tm()),tC=R.Z.div(th()),tj=R.Z.div(tf()),t_=R.Z.div(tp(),function(e){return e.$active,""}),tI=R.Z.div(tg()),tN=R.Z.input(tv()),tS=R.Z.div(tx()),tD=n(94750),tR=n(60478),tA=n(74966),tP=n(76768),tL=n(42474),tZ=n(12221),tq=n(20987),tB=n(73779),tE=n(65990);function tF(e){var t=e.clientThreadId,n=e.isNewThread,a=e.currentModelId,r=e.showPromptStarters,o=e.onRequestCompletion,i=e.onNewThreadCreationFinished,s=e.promptTextareaRef,l=(0,V.B$)(),d=(0,q.qN)(function(e){var n,a,r,o,i,s;return i=(null===(a=(n=q.iN.getCurrentNode(t,e)).message)||void 0===a?void 0:a.author.role)===P.uU.User,s=(null===(r=n.metadata)||void 0===r?void 0:r.err)!=null&&(null===(o=n.metadata)||void 0===o?void 0:o.errCode)!==tR.qS.ContentPolicy,i||s});return!l&&d?(0,m.jsx)(tU,{clientThreadId:t}):(0,m.jsxs)(tP.Z,{children:[n&&(0,m.jsx)(tA.sw,{}),(0,m.jsx)(tO,{clientThreadId:t,currentModelId:a,isNewThread:n,showPromptStarters:r,onRequestCompletion:o,onNewThreadCreationFinished:i,promptTextareaRef:s})]})}function tU(e){var t=e.clientThreadId,n=(0,tq.Z)(t),a=(0,e9.WA)(t),r=(0,q.qN)(function(e){var n;return(null===(n=q.iN.getCurrentNode(t,e).metadata)||void 0===n?void 0:n.errCode)===tZ.uU}),o=(0,tZ.Y8)(function(e){return e.isoDate}),s=(0,O.w$)(),l=(0,q.oq)(t);return r&&null!=o&&""!==o?null:(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"mb-3 text-center text-xs",children:(0,m.jsx)(S.Z,(0,i._)({},tz.errorGeneratingResponse))}),(0,m.jsx)("div",{className:"flex items-center md:mb-4",children:(0,m.jsxs)(W.z,{as:"button",color:"primary",onClick:function(){n({id:l,eventMetadata:{eventSource:"mouse"},conversationMode:a})},className:"m-auto",children:[(0,m.jsx)(j.Qxo,{className:(0,Y.default)("flex-shrink-0",s?"icon-xs":"icon-sm")}),(0,m.jsx)(S.Z,(0,i._)({},tz.regenerateResponse))]})})]})}function tO(e){var t,n,a,r,o,i,s,l,d,c,u,f,p,x,b,y,k=e.clientThreadId,M=e.currentModelId,w=e.isNewThread,T=e.onRequestCompletion,j=e.onNewThreadCreationFinished,_=e.promptTextareaRef,I=e.showPromptStarters,N=(0,q.oq)(k),S=(0,q.Hk)(k),D=(0,H.i)(),R=(0,V.Yk)(S),A=(0,e9.WA)(k),B=(0,C.useCallback)(function(e){g.A.logEvent(v.M.continueCompletion),T({type:P.Os.Continue,promptId:e,eventMetadata:{eventSource:"mouse"},cancelActiveRequests:!1,completionMetadata:{conversationMode:A}})},[T,A]),E=(0,C.useContext)(U.QL).historyDisabled,O=(0,C.useCallback)(function(e,t){var n,a=q.tQ.getTree(k);a.hasReceivedServerCompletion||E||(null===(n=a.getParent(t).metadata)||void 0===n?void 0:n.errCode)===tR.qS.ContentPolicy||setTimeout(function(){j()},500),V.hx.abortRequest(t)&&q.tQ.updateTree(k,function(e){var t=q.tQ.getThreadCurrentLeafId(k);e.updateNodeMessageMetadata(t,{finish_details:{type:"interrupted"}})})},[j,E,k]),z=(0,C.useCallback)(function(e,t,n,a,r,o){var i=q.tQ.getThreadCurrentLeafId(k);q.tQ.setNewThreadConversationModeMetadata(k,null==a?void 0:a.conversationMode),q.tQ.updateTree(k,function(n){n.addNode(e,t,i,P.uU.User,void 0,r)}),T({type:P.Os.Next,promptId:e,eventMetadata:n,cancelActiveRequests:!0,completionMetadata:a,appendMessages:o})},[k,T]),Q=(0,q.lA)(k,N),G=(0,q.dz)(k,N),W=(0,V.Yk)(S),J=(0,C.useMemo)(function(){return!W&&!Q&&G},[Q,G,W]),Y=(0,q.Kt)(k),K=(r=(0,F.hz)(),o=(0,e9.WA)(k),i=(0,h.Po)(k),l=(s=(0,tB.QH)()).gizmoEditorData,d=s.mode,c=o.kind===P.OL.GizmoMagicCreate||o.kind===P.OL.GizmoTest||o.kind===P.OL.GizmoInteraction,f=(u=(0,ew.a)({queryKey:["promptStarters",k],queryFn:function(){return L.ZP.getSampledPromptStarter(4)},enabled:r.has(Z.Zz)&&w&&!Y&&!c})).data,p=u.isLoading,x=u.isSuccess,r.has(Z.Zz)?"test"===d&&l?{promptStarters:null!==(n=null===(t=l.promptStarters)||void 0===t?void 0:t.map(function(e){return{title:"",body:e,prompt:e}}))&&void 0!==n?n:[],isLoading:!1,isSuccess:!0}:null!=i?{promptStarters:null===(a=i.gizmo.display.prompt_starters)||void 0===a?void 0:a.map(function(e){return{title:"",body:e,prompt:e}}),isLoading:!1,isSuccess:!0}:{promptStarters:(null==f?void 0:f.items.map(function(e){return{title:e.title,body:e.description,prompt:e.prompt}}))||[],isLoading:p,isSuccess:x}:{promptStarters:[],isLoading:!1,isSuccess:!0}),$=K.promptStarters,X=K.isSuccess,ee=(0,tE.x0)(),et=(null==ee?void 0:ee.messageId)===(null===(b=q.tQ.getTree(k).getLastValidNode(N))||void 0===b?void 0:null===(y=b.message)||void 0===y?void 0:y.id)?null==ee?void 0:ee.suggestions:I&&!Y&&X?$:void 0,en=(0,e7.iu)().size?D.displayingSideBySideFeedback&&D.unskippable?"feedbackRequired":null:"noModelsAvailable",ea=(0,q.r7)(k);return(0,m.jsx)(tL.ZP,{clientThreadId:k,onCreateNewCompletion:z,onAbortCompletion:O,onContinueGenerating:B,currentModelId:M,isNewThread:w,isCompletionInProgress:R,className:"stretch mx-2 flex flex-row gap-3 last:mb-2 md:mx-4 md:last:mb-6 lg:mx-auto lg:max-w-2xl xl:max-w-3xl",canContinue:J,suggestions:null!=et?et:[],disabled:!!en,disabledReason:null!=en?en:void 0,canPause:W&&"gpt-4-pbrowse"!==M,isInteractableSharedThread:ea,ref:_},k)}var tz=(0,N.vU)({errorGeneratingResponse:{id:"PromptTextarea.errorGeneratingResponse",defaultMessage:"There was an error generating a response",description:"Error message shown when the response generation fails"},regenerateResponse:{id:"PromptTextarea.regenerateResponse",defaultMessage:"Regenerate",description:"Button label for regenerating response"}}),tQ=n(25913),tG=n(9304);function tW(e){return tV.apply(this,arguments)}function tV(){return(tV=(0,o._)(function(e){var t,n;return(0,u.Jh)(this,function(a){switch(a.label){case 0:return(t=(0,d._)(e.queryKey,2))[0],n=t[1],[4,L.ZP.getThreadInterpreterState(n).then(function(e){return 0===e.time_remaining_ms&&e.kernel_started&&ei.m.warning("This advanced data analysis (beta) chat has timed out. You may continue the conversation, but previous files, links, and code blocks below may not work as expected.",{hasCloseButton:!0,duration:0}),e})];case 1:return[2,a.sent()]}})})).apply(this,arguments)}var tH=n(45567),tJ=n(93778),tY=n(71690),tK=n(23234),t$=n(42545);(a=r||(r={}))[a.GPT_AVAILABLE=0]="GPT_AVAILABLE",a[a.GPT_UNAVAILABLE=1]="GPT_UNAVAILABLE",a[a.DEFAULT_GPT=2]="DEFAULT_GPT";var tX=function(e){var t=e.threadData;return e.gizmo?r.GPT_AVAILABLE:null!=t.gizmoId?r.GPT_UNAVAILABLE:r.DEFAULT_GPT},t0=function(e){var t=e.clientThreadId,n=(0,tK.O)(),a=(0,tK.J)(),o=(0,q.UL)(t),l=(0,F.m0)(),d=(0,h.kg)(o.gizmoId),c=d.data;if(d.isLoading||void 0===n)return null;if(!l&&!1===n)return c?(0,m.jsx)(t$.p,{href:(0,h.m_)(c),children:(0,m.jsx)("div",{children:(0,m.jsx)(S.Z,(0,s._)((0,i._)({},t1.userUpgrade),{values:{gizmoName:null==c?void 0:c.gizmo.display.name,bolded:function(e){return(0,m.jsx)("span",{className:"font-bold",children:e})}}}))})}):(0,m.jsx)(t$.p,{href:(0,Q.cy)(),children:(0,m.jsx)("div",{children:(0,m.jsx)(S.Z,(0,s._)((0,i._)({},t1.userUpgradeNoGizmo),{values:{bolded:function(e){return(0,m.jsx)("span",{className:"font-bold",children:e})}}}))})});var u=tX({threadData:o,gizmo:c});return function(){switch(u){case r.GPT_AVAILABLE:if(!c)return null;return(0,m.jsx)(t$.p,{href:(0,h.m_)(c),children:(0,m.jsx)("div",{children:(0,m.jsx)(S.Z,(0,s._)((0,i._)({},t1.gptAvailable),{values:{gizmoName:null==c?void 0:c.gizmo.display.name,bolded:function(e){return(0,m.jsx)("span",{className:"font-bold",children:e})}}}))})});case r.GPT_UNAVAILABLE:if(!a)return(0,m.jsx)(t$.p,{href:"/",children:(0,m.jsx)("div",{children:(0,m.jsx)(S.Z,(0,s._)((0,i._)({},t1.gptDefault),{values:{bolded:function(e){return(0,m.jsx)("span",{className:"font-bold",children:e})}}}))})});return(0,m.jsx)(t$.p,{href:(0,Q.AA)(),children:(0,m.jsx)("div",{children:(0,m.jsx)(S.Z,(0,s._)((0,i._)({},t1.gptUnavailable),{values:{bolded:function(e){return(0,m.jsx)("span",{className:"font-bold",children:e})}}}))})});case r.DEFAULT_GPT:default:return(0,m.jsx)(t$.p,{href:"/",children:(0,m.jsx)("div",{children:(0,m.jsx)(S.Z,(0,s._)((0,i._)({},t1.gptDefault),{values:{bolded:function(e){return(0,m.jsx)("span",{className:"font-bold",children:e})}}}))})})}}()},t1=(0,N.vU)({gptAvailable:{id:"GizmoSharedConversationCTA.gptAvailable",defaultMessage:"Chat with <bolded>{gizmoName}</bolded> on ChatGPT",description:"CTA for a shared conversation with a GPT"},gptUnavailable:{id:"GizmoSharedConversationCTA.gptUnavailable",defaultMessage:"Create your own <bolded>GPT</bolded>",description:"CTA for a shared conversation with a GPT that is no longer available"},gptDefault:{id:"GizmoSharedConversationCTA.gptDefault",defaultMessage:"Get started with <bolded>ChatGPT</bolded>",description:"CTA for a shared conversation with the default GPT"},userUpgrade:{id:"GizmoSharedConversationCTA.userUpgrade",defaultMessage:"Upgrade to Plus to chat with <bolded>{gizmoName}</bolded>",description:"Upgrade CTA for free users"},userUpgradeNoGizmo:{id:"GizmoSharedConversationCTA.userUpgradeNoGizmo",defaultMessage:"Upgrade to Plus to create your own <bolded>GPT</bolded>",description:"Upgrade CTA for free users"}}),t2=n(41187),t4=n(95413);function t3(){var e=(0,c._)(["grow flex-1 overflow-hidden"]);return t3=function(){return e},e}function t5(){var e=(0,c._)(["w-full pt-2 md:pt-0 dark:border-white/20 md:border-transparent md:dark:border-transparent md:w-[calc(100%-.5rem)]"]);return t5=function(){return e},e}var t6=b()(function(){return Promise.all([n.e(1966),n.e(4388)]).then(n.bind(n,64388))},{loadableGenerated:{webpack:function(){return[64388]}},ssr:!1}),t9=(0,N.vU)({doNotShareSensitive:{id:"thread.modal.onboarding.title",defaultMessage:"Do not share sensitive materials with this application",description:"Title for the onboarding warning modal"},mayProduceInaccurateInformation:{id:"thread.chatgptMayProduceInaccurateInformation-oct-30",defaultMessage:"ChatGPT can make mistakes. Consider checking important information.",description:"ChatGPT disclaimer for producing inaccurate information"},businessDisclaimer:{id:"thread.businessDisclaimer-oct-30",defaultMessage:"{workspaceName} workspace chats aren't used to train our models. ChatGPT can make mistakes.",description:"Business disclaimer with protected data assurance"},businessDisclaimerNoName:{id:"thread.businessDisclaimerNoName-oct-30",defaultMessage:"Your workspace chats aren'ts used to train our models. ChatGPT can make mistakes.",description:"Business disclaimer with protected data assurance when no Workspace name is available"},outdatedGptDisclaimer:{id:"thread.outdatedGptDisclaimer.0",defaultMessage:"<bold>New version of GPT available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version.",description:"Outdated GPT disclaimer"},outdatedTemplateDisclaimer:{id:"thread.outdatedTemplateDisclaimer",defaultMessage:"<bold>New version of template available</bold> - Continue chatting to use the old version, or start a <link>new chat</link> for the latest version.",description:"Outdated template disclaimer"},somethingWentWrong:{id:"thread.modal.unrecoverableError.title",defaultMessage:"Something went wrong",description:"Title for the UnrecoverableErrorModal"},tryAgainLater:{id:"thread.modal.unrecoverableError.description",defaultMessage:"We're sorry, but something went wrong. Please try again later.",description:"Description for the UnrecoverableErrorModal"},resetThread:{id:"thread.modal.unrecoverableError.resetThread",defaultMessage:"Reset thread",description:"Reset thread button text"},sharedConversationContinueConversation:{id:"thread.sharedConversation.continue",defaultMessage:"Continue this conversation",description:"Button for shared links to allow user to continue conversation in their own history"},sharedConversationReportConversation:{id:"thread.sharedConversation.report",defaultMessage:"Report conversation",description:"Button for shared links to report chat for legal, safety, or other reasons"},sharedConversationModerateConversation:{id:"thread.sharedConversation.moderate",defaultMessage:"Moderate conversation",description:"Button for shared links to moderate a chat for legal, safety, or other reasons"},reportSharedConversation:{id:"thread.reportSharedConversation",defaultMessage:"Report content",description:"Report shared chat footer link text"},termsOfUse:{id:"thread.termsOfUse",defaultMessage:"Terms of use",description:"Terms of use footer link text"},privacyPolicy:{id:"thread.privacyPolicy",defaultMessage:"Privacy policy",description:"Privacy policy footer link text"},latencyButton:{id:"thread.latencyButton",defaultMessage:"Latency",description:"Button to open the latency menu"}});function t7(e){var t=e.onClickReportSharedConversation;return(0,m.jsxs)("div",{className:"flex justify-center gap-3 text-gray-500",children:[(0,m.jsx)("button",{onClick:function(){t()},children:(0,m.jsx)(S.Z,(0,i._)({},t9.reportSharedConversation))}),(0,m.jsx)("span",{children:"|"}),(0,m.jsx)("a",{href:"https://openai.com/policies/terms-of-use",target:"_blank",rel:"noreferrer",children:(0,m.jsx)(S.Z,(0,i._)({},t9.termsOfUse))}),(0,m.jsx)("span",{children:"|"}),(0,m.jsx)("a",{href:"https://openai.com/policies/privacy-policy",target:"_blank",rel:"noreferrer",children:(0,m.jsx)(S.Z,(0,i._)({},t9.privacyPolicy))})]})}function t8(e){var t=e.clientThreadId,n=(0,F.ec)(function(e){return e.currentWorkspace}),a=null==n?void 0:n.id,r=(0,q.UL)(t),o=null==r?void 0:r.conversationTemplateId;if(null!=a&&null!=o)return(0,m.jsx)(ne,{clientThreadId:t,workspaceId:a,conversationTemplateId:o});var i=null==r?void 0:r.gizmoId;return null!=i?(0,m.jsx)(nt,{clientThreadId:t,gizmoId:i}):(0,m.jsx)(nn,{})}function ne(e){var t=e.clientThreadId,n=e.workspaceId,a=e.conversationTemplateId,r=(0,G.GS)(n,a).data,o=(0,q.qN)(function(e){return q.iN.getThreadCreateTime(t,e)}),l=(null==r?void 0:r.updated_at)!=null?new Date(r.updated_at):void 0;return null==l||null==o||l<=o?(0,m.jsx)(nn,{}):(0,m.jsxs)("span",{className:"text-gray-500",children:[(0,m.jsx)(_.h5O,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),(0,m.jsx)(S.Z,(0,s._)((0,i._)({},t9.outdatedTemplateDisclaimer),{values:{link:function(e){return(0,m.jsx)(w(),{href:(0,G.l1)(a),className:"underline",shallow:!0,children:e})},bold:function(e){return(0,m.jsx)("span",{className:"text-token-secondary font-semibold",children:e})}}}))]})}function nt(e){var t=e.clientThreadId,n=e.gizmoId,a=(0,h.b9)(n).data,r=(0,q.qN)(function(e){return q.iN.getThreadCreateTime(t,e)}),o=(null==a?void 0:a.gizmo.updated_at)!=null?new Date(a.gizmo.updated_at):void 0;return(null==a?void 0:a.gizmo.short_url)==null||null==o||null==r||o<=r?(0,m.jsx)(nn,{}):(0,m.jsxs)("span",{className:"text-gray-500",children:[(0,m.jsx)(_.h5O,{className:"text-token-secondary mb-1 mr-1 inline-block h-4 w-4 stroke-0"}),(0,m.jsx)(S.Z,(0,s._)((0,i._)({},t9.outdatedGptDisclaimer),{values:{link:function(e){return(0,m.jsx)(w(),{href:(0,h.un)(a.gizmo.short_url),className:"underline",shallow:!0,children:e})},bold:function(e){return(0,m.jsx)("span",{className:"text-token-secondary font-semibold",children:e})}}}))]})}function nn(){var e=(0,F.ec)(F.F_.isBusinessWorkspace),t=(0,F.ec)(function(e){return e.currentWorkspace}),n=null==t?void 0:t.name;return e?(0,m.jsx)("span",{children:null!=n?(0,m.jsx)(S.Z,(0,s._)((0,i._)({},t9.businessDisclaimer),{values:{workspaceName:n}})):(0,m.jsx)(S.Z,(0,i._)({},t9.businessDisclaimerNoName))}):(0,m.jsx)("span",{children:(0,m.jsx)(S.Z,(0,i._)({},t9.mayProduceInaccurateInformation))})}var na=function(e){var t,n,a,r,i,s,c,x,b,y,M,w,_,N,S,R=e.initialThreadData,J=e.clientThreadId,Y=e.initiallyHighlightedMessageId,K=e.continueConversationUrl,$=e.onCompletionFinished,X=e.preRequestCompletion,ee=e.hideHeader,et=e.prependThreadChildren,en=e.renderEmptyState,ea=null!==(0,C.useContext)(U.gB),er=(0,D.Z)(),eo=(0,F.hz)(),ei=(0,B.H)().isPluginsAvailable,es=(0,O.w$)(),el=(0,C.useContext)(U.QL).historyDisabled,ed=(0,H.i)(),ec=(0,e9.Wq)(J),eu=(0,T.useRouter)(),eh=ea&&(null===(w=eu.query)||void 0===w?void 0:null===(_=w.shareParams)||void 0===_?void 0:_[1])==="moderate",ef=(0,q.Kt)(J),ep=(0,q.oq)(J),eg=(0,q.JI)(J,ep),ev=(0,q.U0)(J,ep),ex=(0,q.je)(J),eb=(0,d._)((0,C.useState)(),2),ek=eb[0],eT=eb[1],eC=(0,d._)((0,C.useState)(!1),2),ej=eC[0],e_=eC[1],eI=(0,d._)((0,C.useState)(),2),eS=eI[0],eD=eI[1],eR=(0,d._)((0,C.useState)(),2),eA=eR[0],eL=eR[1],eZ=(0,d._)((0,C.useState)(),2),eE=eZ[0],eU=eZ[1],ez=eo.has(Z.AL),eQ=(0,e7.iu)(),eG=(0,eq.p0)(),eW=ev>=2,eV=eg.some(function(e){return e.role===P.uU.User}),eH=(0,q.Zz)(J)&&!eW&&(0,e9.HE)(ec),eJ=(0,q.Zz)(J)&&!eV&&((0,e9.HE)(ec)||ec.kind===P.OL.GizmoTest),eY=(0,e7.Gg)(eQ,!0),eK=null!==(S=(0,e7.Bv)(R.lastModelUsed,J))&&void 0!==S?S:eY,e$=(0,e7.B9)(),eX=e$.get(eK),e0=(0,tQ.iF)(),e1=(0,C.useCallback)(function(){e0(),g.A.logEvent(v.M.newThread)},[e0]),e2=(r=(0,q.Zz)(J),i=q.tQ.getTitle(J),ec.kind===P.OL.GizmoInteraction&&ec.gizmo?r?"ChatGPT - ".concat(ec.gizmo.gizmo.display.name):i?"".concat(ec.gizmo.gizmo.display.name," - ").concat(i):i:r?"ChatGPT":i);(0,G.dB)(J);var e4=(0,e9.WA)(J),e3=(0,C.useCallback)(function(e){if(!el&&e){var t=q.tQ.getTree(e).getMessageId(q.tQ.getThreadCurrentLeafId(e));if(L.ZP.generateTitle(e,t,eK).then(function(t){var n=t.title;q.tQ.setTitle(e,n,q._L.Generated),e0(),g.A.logEvent(v.M.renameThread,{threadId:e,content:n,model:eK})}).catch(function(e){console.error(e)}),(0,e9.HE)(ec)){var n=function(){eu.push((0,Q.ZV)(e),void 0,{shallow:!0})},a=q.iN.getGizmoId(J);null!=a?(0,h.F0)(a).then(function(t){history.pushState({},"",(0,Q.ZV)(e,t))}).catch(function(e){console.error(e),n()}):n()}}},[J,el,eK,e0,eu,ec]);(0,C.useEffect)(function(){(0,tE.sb)()},[]);var e5=(0,C.useCallback)(function(e){if(null!=e&&(null==$||$(e),!el)&&(e4.kind===P.OL.GizmoInteraction&&h.D2.handleGizmoInteracted(e4.gizmo_id),(0,F.N$)().has(Z.uj)&&!ed.displayingSideBySideFeedback)){var t=q.tQ.getThreadCurrentLeafId(e),n=q.tQ.getTree(e).getMessage(t);(0,z.lD)(n)||(0,z.JD)(n)||(0,tE.yu)(e,n.id,eK)}},[el,eK,ed.displayingSideBySideFeedback,$,e4]),e6=(0,q.Uy)(J),te=ei&&(null==eX?void 0:null===(N=eX.enabledTools)||void 0===N?void 0:N.includes("tools3"))?eG:void 0,tt=null==te?void 0:te.map(function(e){return e.id}),tn=(0,tG.Z)(J,e6,e1,e3,e5,tt),ta=(0,C.useCallback)(function(){var e=q.tQ.getThreadCurrentLeafId(J);if(null!=e){var t=q.tQ.getTree(J).getBranchFromLeaf(e);V.hx.abortRequests(t.map(function(e){return e.id}))}},[J]),tr=(0,tD.N)(),to=(0,C.useCallback)((s=(0,o._)(function(e){var t,n,a,r,o,i,s,l,d,c,m,h,p,g,v;return(0,u.Jh)(this,function(u){switch(u.label){case 0:if(t=e.type,n=e.promptId,a=e.eventMetadata,r=e.cancelActiveRequests,i=void 0===(o=e.focusOnNewCompletion)||o,s=e.useDefaultModel,l=e.completionMetadata,d=e.appendMessages,(0,tE.sb)(),r&&ta(),m=performance.now(),h=s?eY:eK,p=null===(c=e$.get(h))||void 0===c?void 0:c.tags,g=l.conversationMode,!(0,f.Rr)(eo,null!=p?p:[],g.kind))return[3,2];return[4,f.ZP.getEnforcementToken(null!=p?p:[])];case 1:v=u.sent(),u.label=2;case 2:return null==X||X(J,n),tn({model:h,completionType:t,parentNodeId:n,metadata:a,focusOnNewCompletion:i,completionMetadata:l,arkoseToken:null!=v?v:null,preflightTime:performance.now()-m,extraStreamParams:{forceParagen:tr.forceParagen,forceRateLimit:tr.forceRateLimit},appendMessages:d}),[2]}})}),function(e){return s.apply(this,arguments)}),[J,eY,eK,e$,tn,ta,tr.forceParagen,tr.forceRateLimit,X,eo]),ts=(0,C.useCallback)(function(e,t,n,a){q.tQ.updateTree(J,function(r){r.addNode(e,n,t,P.uU.User,void 0,a)})},[J]),tl=(0,C.useCallback)((c=(0,o._)(function(e,t,n,a){var r,o;return(0,u.Jh)(this,function(i){return r=t.content,o=t.attachments,q.tQ.setNewThreadConversationModeMetadata(J,a.conversationMode),ts(e,ep,r,o.length>0?{attachments:o}:{}),to({type:P.Os.Next,promptId:e,eventMetadata:n,cancelActiveRequests:!0,completionMetadata:a}),[2]})}),function(e,t,n,a){return c.apply(this,arguments)}),[J,ts,to,ep]),td=(0,C.useRef)(!1),tc=(0,e7.B8)(),tu=(0,p.kP)().session;(0,C.useEffect)(function(){if(tu&&void 0!==eX&&(void 0===eX.enabledTools||!(eX.enabledTools.length>0))&&eo.has(Z.Yj)&&0!==tc.enabledModelsInCategoriesById.size&&!td.current&&void 0===q.tQ.getServerThreadId(J)){var e,t=eu.query,n=t.m,a=(0,l._)(t,["m"]);if(void 0!==n){e=Array.isArray(n)?n[0]:n;var r=(0,A.Z)();td.current=!0,tl(r,{content:e,attachments:[]},{eventSource:"url"},{conversationMode:e4}),eu.replace({pathname:eu.pathname,query:a},void 0,{shallow:!0})}}},[eX,eu,tl,tu,tc,eo,J,e4]);var tm=(0,C.useCallback)(function(e,t){var n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none",r=arguments.length>4?arguments[4]:void 0,o=q.tQ.getTree(J).getParentPromptNode(e).id;to({type:P.Os.Variant,promptId:o,eventMetadata:t,cancelActiveRequests:!1,focusOnNewCompletion:n,useDefaultModel:r,completionMetadata:{variantPurpose:a,conversationMode:e4}})},[to,J,e4]),th=(0,C.useCallback)(function(e){var t=q.tQ.getTree(J).getLeafFromNode(e);q.tQ.setThreadCurrentLeafId(J,t.id)},[J]),tf=(0,C.useCallback)(function(e,t,n){var a=q.tQ.getServerThreadId(J);if(g.A.logEvent(v.M.thumbRating,{id:t,threadId:a,rating:n,model:eK}),void 0!==a&&L.ZP.submitMessageFeedback({message_id:t,conversation_id:a,rating:n}),eL(e),eU(t),eD(n),q.tQ.updateTree(J,function(t){t.updateNodeMetadata(e,{rating:n})}),"thumbsDown"===n&&es){var r=q.tQ.getTree(J).getConversationTurns(e||"root");em(r[r.length-1])&&tm(e,{eventSource:"mouse",intent:"comparison"},!1,"comparison")}},[J,eK,es,tm]),tp=(0,eO.tS)(function(e){return{showEmbeddedPaymentModal:e.showEmbeddedPaymentModal,setShowEmbeddedPaymentModal:e.setShowEmbeddedPaymentModal}}),tg=tp.showEmbeddedPaymentModal,tv=tp.setShowEmbeddedPaymentModal,tx=(0,eP.C)(function(e){return{setShowReferralInviteModal:e.setShowReferralInviteModal}}).setShowReferralInviteModal,tb=(0,C.useCallback)(function(){tv(!1)},[tv]),tk=(0,C.useCallback)(function(){tx(!1)},[tx]),tM=(0,C.useRef)(null),tw=(0,q.XK)(J),tT=(0,E.tN)(function(e){return e.sharingModalThreadId===tw}),tC=(0,eP.C)(function(e){return e.showReferralInviteModal});return b=(x={clientThreadId:J,currentModelId:eK}).clientThreadId,y=x.currentModelId,t=(0,e8.i0)(y,e8.dN.CODE_INTERPRETER),n=null!==(0,C.useContext)(U.gB),a=q.tQ.getServerThreadId(b),(0,ew.a)({queryKey:["interpreterState",a],queryFn:tW,enabled:!!(t&&a&&!n),gcTime:0}),(0,m.jsxs)(m.Fragment,{children:[ez&&(0,m.jsx)(t6,{}),(0,m.jsxs)(k(),{children:[null!=e2&&(0,m.jsx)("title",{children:e2}),ea&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("meta",{property:"og:site_name",content:"ChatGPT"}),(0,m.jsx)("meta",{name:"robots",content:"noindex,nofollow"},"robots"),(0,m.jsx)("meta",{property:"og:title",content:null!=e2?e2:"Shared Chat on ChatGPT"},"og:title"),(0,m.jsx)("meta",{property:"og:description",content:"Shared "+(null!=ex?"by ".concat(ex," "):"")+"via ChatGPT"},"og:description"),(0,m.jsx)("meta",{property:"og:image",content:tY.Z.src},"og:image")]})]}),ec.kind===P.OL.GizmoInteraction&&ec.gizmo&&(0,m.jsx)(tJ.N,{gizmo:ec.gizmo}),(0,m.jsxs)(U.OV.Provider,{value:to,children:[eo.has(Z.i)?(0,m.jsx)(eB,{}):null,tT&&null!=tw&&(0,m.jsx)(ty,{serverThreadId:tw,currentThreadModel:R.lastModelUsed}),(0,m.jsxs)(eM.ZP,{clientThreadId:J,currentModelConfig:eX,className:"flex h-full flex-col",children:[(0,m.jsx)(nr,{children:ef?null:eJ?null!=en?en:(0,m.jsx)(t2.iD,{clientThreadId:J,currentModel:null!=eX?eX:e7.IR}):eW?(M=(0,m.jsxs)(m.Fragment,{children:[et,(0,m.jsx)(ti,{onChangeItemInView:th,onRequestMoreCompletions:tm,onChangeRating:tf,onRequestCompletion:to,clientThreadId:J,currentThreadModel:R.lastModelUsed,initiallyHighlightedMessageId:Y,inlineEmbeddedDisplay:!1,conversationLeafId:ep,hideHeader:ee},J)]}),ea?(0,m.jsx)("div",{className:"h-full overflow-auto dark:bg-gray-800",children:M}):(0,m.jsx)(tH.I,{children:M})):null}),(0,m.jsxs)(no,{children:[ea?(0,m.jsxs)("div",{className:"relative flex w-full flex-1 items-center justify-center gap-2 pt-3 empty:hidden",children:[(0,m.jsx)(t0,{clientThreadId:J}),eh&&(0,m.jsx)(W.z,{onClick:function(){e_(!0)},children:er.formatMessage(t9.sharedConversationModerateConversation)}),eo.has("debug")&&K&&(0,m.jsxs)(W.z,{color:"neutral",as:"link",to:K,children:[(0,m.jsx)(I.sUY,{className:"icon-sm"}),er.formatMessage(t9.sharedConversationContinueConversation)]})]}):(0,m.jsx)(tF,{clientThreadId:J,isNewThread:eH,showPromptStarters:eH||!eV,currentModelId:eK,onRequestCompletion:to,onNewThreadCreationFinished:e3,promptTextareaRef:tM}),(0,m.jsx)("div",{className:"relative px-2 py-2 text-center text-xs text-gray-600 dark:text-gray-300 md:px-[60px]",children:ea?(0,m.jsx)(t7,{onClickReportSharedConversation:function(){eT(ep)}}):(0,e9.HE)(ec)?(0,m.jsx)(t8,{clientThreadId:J}):null})]})]}),(0,m.jsxs)("div",{className:"group fixed bottom-3 right-3 z-10 hidden gap-1 lg:flex",children:[ez&&(0,m.jsx)("button",{onClick:function(){E.vm.showLatencyDevTools()},className:"box-content flex h-6 w-6 items-center justify-center rounded-full border border-gray-200 bg-gray-50 text-xs text-gray-600 dark:border-white/10 dark:bg-white/10 dark:text-gray-200",children:(0,m.jsx)(j.DKx,{className:"icon-sm"})}),(0,m.jsx)(t4.Z,{})]}),(0,m.jsx)(ey,{clientThreadId:J,currentLeafId:ep,currentModelId:eK,onChangeItemInView:th,onRequestMoreCompletions:tm,onChangeRating:tf,onRequestCompletion:to,ratingModalOpen:eS,ratingModalNodeId:eA,ratingModalCompletionId:eE,sharedConversationReportModalNodeId:ek,setSharedConversationReportModalNodeId:eT,sharedConversationModerationModalOpen:ej,setRatingModalOpen:eD,setSharedConversationModerationModalOpen:e_}),(0,m.jsx)(eF,{isOpen:tg,onClose:tb}),eo.has(Z.a3)&&(0,m.jsx)(eN,{isOpen:tC,onClose:tk})]})]})},nr=R.Z.div(t3()),no=R.Z.div(t5())},45567:function(e,t,n){n.d(t,{I:function(){return i}});var a=n(35250),r=n(5397),o=n.n(r)()(function(){return Promise.resolve().then(n.bind(n,40803))},{loadableGenerated:{webpack:function(){return[40803]}},ssr:!1});function i(e){var t=e.children,n=e.scrollViewClassName;return(0,a.jsx)(o,{className:"h-full",followButtonClassName:"scroll-convo",initialScrollBehavior:"auto",scrollViewClassName:n,children:t})}},93778:function(e,t,n){n.d(t,{N:function(){return s}});var a=n(35250),r=n(21950),o=n(29124),i=n.n(o);function s(e){var t=e.gizmo,n=(0,r.uy)(t.gizmo.display.name);return(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:n}),(0,a.jsx)("meta",{name:"title",content:n},"title"),(0,a.jsx)("meta",{property:"og:site_name",content:"ChatGPT"},"og:site_name"),(0,a.jsx)("meta",{property:"og:type",content:"website"},"og:type"),(0,a.jsx)("meta",{property:"og:title",content:n},"og:title"),(0,a.jsx)("meta",{property:"og:url",content:(0,r.i6)(t)},"og:url"),t.gizmo.display.description&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("meta",{name:"description",content:t.gizmo.display.description},"description"),(0,a.jsx)("meta",{property:"og:description",content:t.gizmo.display.description},"og:description")]}),t.gizmo.display.profile_picture_url&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("meta",{property:"og:image",content:t.gizmo.display.profile_picture_url},"og:image"),(0,a.jsx)("meta",{property:"og:image:width",content:"512"},"og:image:width"),(0,a.jsx)("meta",{property:"og:image:height",content:"512"},"og:image:height")]})]})}},42545:function(e,t,n){n.d(t,{p:function(){return i}});var a=n(35250),r=n(73040),o=n.n(r);function i(e){var t=e.href,n=e.children;return(0,a.jsx)(o(),{href:t,shallow:!0,className:"flex items-center gap-2 rounded-xl bg-green-600 px-5 py-3.5 font-medium text-white transition hover:opacity-70",children:n})}},9304:function(e,t,n){n.d(t,{Z:function(){return E}});var a=n(21722),r=n(39324),o=n(71209),i=n(64502),s=n(38104),l=n(2064),d=n(54636),c=n(42780),u=n(51217),m=n(8844),h=n(61098);function f(){return(f=(0,a._)(function(e,t){var n,a;return(0,s.Jh)(this,function(r){switch(r.label){case 0:if((null===(n=t.metadata)||void 0===n?void 0:n.client_actions)===void 0||0===t.metadata.client_actions.length||0==(a=t.metadata.client_actions.filter(function(e){return"browser_tool"===e.type})).length)return[2,[]];return[4,Promise.all(a.map(function(n){return function(e,t,n){return g.apply(this,arguments)}(e,n.action,t)}))];case 1:return[2,r.sent().flat()]}})})).apply(this,arguments)}var p=function(){function e(t){(0,u._)(this,e),this.conversationId=t}var t=e.prototype;return t.createRequest=function(e){var t=this;return new Promise(function(n,a){var i=new BroadcastChannel(Math.random().toString()),s=setTimeout(function(){a("Timeout"),i.close()},6e4);i.onmessage=function(e){n(e.data),clearTimeout(s),i.close()};var l=(0,o._)((0,r._)({action:"browse",id:t.conversationId},e),{channel:i.name});window.postMessage(l,"*")})},t.browse=function(e){return this.createRequest({url:e,type:"browse"})},t.back=function(){return this.createRequest({type:"back"})},t.click=function(e){return this.createRequest({target:e,type:"click"})},t.scroll=function(e){return this.createRequest({amount:e,type:"scroll"})},t.quote=function(e,t){return this.createRequest({quote_start:e,quote_end:t,type:"quote"})},e}();function g(){return(g=(0,a._)(function(e,t,n){var a,r;return(0,s.Jh)(this,function(n){var o,i;switch(n.label){case 0:a=new p(e),n.label=1;case 1:switch(n.trys.push([1,14,,15]),t.command){case"back":return[3,2];case"quote":return[3,4];case"scroll":return[3,6];case"open_url":return[3,8];case"click":return[3,10]}return[3,12];case 2:return[4,a.back()];case 3:case 7:case 9:case 11:return[2,[(!function(e){for(var t in e.urls)e.text.includes("".concat(t))||delete e.urls[t]}(o=n.sent()),{id:(0,m.Z)(),author:{role:h.uU.Tool,name:"browser"},content:{content_type:h.PX.TetherBrowsingDisplay,result:o.text,summary:o.title},metadata:{_cite_metadata:{citation_format:{name:"tether_og"},metadata_list:[{type:"webpage",title:o.title,url:o.url,text:o.text}]}},recipient:"all"})]];case 4:return[4,a.quote(t.quote_start,t.quote_end)];case 5:return[2,[(i=n.sent(),{id:(0,m.Z)(),author:{role:h.uU.Tool,name:"browser"},content:{content_type:h.PX.Text,parts:["".concat(JSON.stringify(i))]},recipient:"all"})]];case 6:return[4,a.scroll(t.amount)];case 8:return[4,a.browse(t.url)];case 10:return[4,a.click(t.target)];case 12:throw Error("Unsupported browser action type "+t);case 13:return[3,15];case 14:return console.error(r=n.sent()),[2,[{id:(0,m.Z)(),author:{role:h.uU.Tool,name:"browser"},content:{content_type:h.PX.Text,parts:["Error making browse call: ".concat(r)]},recipient:"all"}]];case 15:return[2]}})})).apply(this,arguments)}var v=n(60478),x=n(89678),b=n.n(x),y=n(70079),k=n(20630),M=n(86646),w=n(66638),T=n(17944),C=n(25687),j=n(88887),_=n(15066),I=n(41955),N=n(8874),S=function e(t){var n,a=this;(0,u._)(this,e),this.blurDuringCompletionTrackerOnUnmountRef=t,this.completionStartTime=Date.now(),this.logFocusAfterBlurDuringCompletionEvent=function(){N.m9.logEvent("chatgpt_focus_after_blur_during_completion",null,{completion_duration_ms:"".concat(a.completionEndTime-a.completionStartTime),blur_time_ms:"".concat(a.blurDuringCompletionTime-a.completionStartTime),refocus_time_ms:"".concat(a.refocusTime-a.completionStartTime)}),d.A.logEvent(c.M.focusAfterBlurDuringCompletion,{completion_duration_ms:"".concat(a.completionEndTime-a.completionStartTime),blur_time_ms:"".concat(a.blurDuringCompletionTime-a.completionStartTime),refocus_time_ms:"".concat(a.refocusTime-a.completionStartTime)})},this.onWindowBlur=function(){void 0===a.blurDuringCompletionTime&&(a.blurDuringCompletionTime=Date.now(),window.addEventListener("focus",a.onWindowFocusAfterBlur),a.blurDuringCompletionTrackerOnUnmountRef.current=a.cleanupFocusAfterBlurListener)},this.onWindowFocusAfterBlur=function(){a.refocusTime=Date.now(),void 0!==a.completionEndTime&&a.logFocusAfterBlurDuringCompletionEvent(),a.cleanupFocusAfterBlurListener()},this.cleanupFocusAfterBlurListener=function(){window.removeEventListener("focus",a.onWindowFocusAfterBlur),a.blurDuringCompletionTrackerOnUnmountRef.current=void 0},this.onMessageError=function(){window.removeEventListener("blur",a.onWindowBlur)},this.onMessageDone=function(){window.removeEventListener("blur",a.onWindowBlur),void 0!==a.blurDuringCompletionTime&&(a.completionEndTime=Date.now(),N.m9.logEvent("chatgpt_blur_during_completion",null,{completion_duration_ms:"".concat(a.completionEndTime-a.completionStartTime),blur_time_ms:"".concat(a.blurDuringCompletionTime-a.completionStartTime)}),d.A.logEvent(c.M.blurDuringCompletion,{completion_duration_ms:"".concat(a.completionEndTime-a.completionStartTime),blur_time_ms:"".concat(a.blurDuringCompletionTime-a.completionStartTime)}),void 0!==a.refocusTime&&a.logFocusAfterBlurDuringCompletionEvent())},window.addEventListener("blur",this.onWindowBlur),null===(n=t.current)||void 0===n||n.call(t)},D=n(45021),R=function(){function e(t){(0,u._)(this,e),this.requestLatencyId=t,this.requestStartTime=performance.now(),this.requestLastTokenTime=performance.now(),this.requestCount=0,this.requestTimes=[]}return e.prototype.onResponse=function(e,t,n){var a,r,o=performance.now(),i=o-this.requestLastTokenTime,s=o-this.requestStartTime;this.requestLastTokenTime=o,this.requestCount+=1;var l=t.content.content_type==h.PX.Text?null==t?void 0:null===(a=t.content)||void 0===a?void 0:a.parts[(null==t?void 0:null===(r=t.content)||void 0===r?void 0:r.parts.length)-1]:"",d={requestCount:this.requestCount,requestDuration:s,lastTokenDuration:Number(JSON.stringify(i)),messageType:t.content.content_type,content:l};this.requestTimes.push(d),"message"===e.type?(0,D.Ae)(this.requestLatencyId,d):"done"===e.type&&null!=n&&((0,D.kn)(this.requestLatencyId),(0,D.gL)(this.requestLatencyId))},e}(),A=n(96251),P=n(12221),L=n(10499);function Z(e,t){e.updateNodeMetadata(t.id,{completionSampleFinishTime:Date.now()})}function q(e,t,n,a,r,o,i,s){return B.apply(this,arguments)}function B(){return(B=(0,a._)(function(e,t,n,a,r,o,i,d){var c,u,m,f;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(u=performance.now(),m=null===(c=r.get(n))||void 0===c?void 0:c.tags,a&&l.ZP.gatherData(null!=m?m:[]),w.tQ.updateTree(e,function(e){var n=!0,a=!1,r=void 0;try{for(var o,s=i[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;e.addNode(l.id,l,t,h.uU.Assistant,{completionSampleFinishTime:Date.now()}),t=l.id}}catch(e){a=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}}),w.tQ.setThreadCurrentLeafId(e,t),!a)return[3,2];return[4,l.ZP.getEnforcementToken(null!=m?m:[])];case 1:f=s.sent(),s.label=2;case 2:return o({model:n,completionType:h.Os.Next,parentNodeId:t,metadata:{},arkoseToken:null!=f?f:null,preflightTime:performance.now()-u,extraStreamParams:d}),[2]}})})).apply(this,arguments)}function E(e,t,n,u,m,p){var g,x=(0,T.hz)(),N=(0,y.useContext)(C.QL).historyDisabled,B=(0,L.B9)(),E=(0,y.useRef)(0),F=(0,y.useRef)(n),U=(0,y.useRef)(u),O=(0,y.useRef)(m);F.current=n,U.current=u,O.current=m;var z=(0,y.useRef)(void 0);(0,y.useEffect)(function(){return function(){var e;return null===(e=z.current)||void 0===e?void 0:e.call(z)}},[]);var Q=(0,y.useCallback)(function(t,n,i,u,m,p){var g,y,M,T,C=u.eventSource,j=function(){setTimeout(function(){I.hx.removeRequest(i),w.tQ.releaseThread(e)},0)},_=w.tQ.getTree(e),N=i,D=n===h.Os.Continue,L=!0,E=!1,Q=_.getMessage(N),W={},V={},H=!1,J=!1,Y=new S(z),K=new R(m),$=b()(function(){H||w.tQ.updateTree(e,function(e){Object.values(W).forEach(function(t){e.updateNodeMessage(t.id,t)})}),W={}},50,{leading:!0,maxWait:50});return g=(0,a._)(function(a){var u,m,g,b,I,S,R,z,X,ee,et,en,ea,er,eo,ei,es,el,ed,ec,eu,em,eh,ef,ep,eg,ev,ex,eb,ey,ek,eM,ew,eT,eC,ej;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(K.onResponse(a,Q,y),u=!0,"error"===a.type)return console.error(m=a.error),g=(null==m?void 0:m.message)||"Something went wrong",w.tQ.updateTree(e,function(e){e.updateNodeMessage(N,Q),e.updateNodeMetadata(N,{err:g,errType:"danger",errCode:(0,k.T)(m)&&m.code||"",completionSampleFinishTime:Date.now()})}),Y.onMessageError(),j(),O.current(y),(0,k.T)(m)&&(null==m?void 0:m.code)===P.uU&&(null==m?void 0:m.clearsIn)&&((0,P.c0)(new Date(Date.now()+1e3*m.clearsIn).toISOString()),setTimeout(function(){(0,P.Zp)()},1e3*m.clearsIn)),[2];if("moderation"===a.type&&(b=a.isCompletion,I=a.messageId,S=a.conversationId,R=a.flagged,z=a.blocked,(R||z)&&(J=!0,z&&b&&(H=!0),w.tQ.updateTree(e,function(e){var t=e.messageIdToNodeId(I);z&&e.clearNodeMessageParts(t),e.updateNodeMetadata(t,(0,o._)((0,r._)({},z?v.sK:v.Mf),{completionSampleFinishTime:Date.now()}))}),d.A.logEvent(b?z?c.M.completionBlockedByModeration:c.M.completionFlaggedByModeration:z?c.M.promptBlockedByModeration:c.M.promptFlaggedByModeration,{threadId:S,id:I}))),"num_variants_in_stream"===a.type)return M=a,[2];if("message"===a.type){if(X=a.message,ee=a.conversationId,L&&!_.hasReceivedServerCompletion){if((null==X?void 0:X.author.role)===h.uU.System)return _.appendSystemMessageToRoot(X),[2];if((null==X?void 0:X.author.role)===h.uU.User||_.hasNodeOrMessageId(X.id))return[2]}L?(en=(null===(et=w.qN.getState().threads[e])||void 0===et?void 0:et.continuingFromSharedConversationId)!=null,w.tQ.removeContinuingFromSharedConversationId(e),L=!1,E=!_.hasReceivedServerCompletion||en,void 0!==ee&&(y=ee,(0,w.Zz)(e)&&w.tQ.setServerIdForNewThread(e,ee)),w.tQ.updateTree(e,function(e){e.updateNodeMessage(N,X)}),E&&F.current(ee),ea={id:i,threadId:ee,completionType:n,eventSource:C,model:t},n===h.Os.Next&&(el=null==(es=w.qN.getState().threads[ee])?void 0:null===(er=es.conversationTurns)||void 0===er?void 0:er.length,(null==(ec=null===(ei=(ed=null==es?void 0:null===(eo=es.conversationTurns)||void 0===eo?void 0:eo.filter(function(e){return e.role==h.uU.User}))[ed.length-1])||void 0===ei?void 0:ei.messages[0].message)?void 0:ec.content.content_type)==h.PX.Text&&(eu=ec.content.parts.join("").length,eh=null!==(em=ed.length)&&void 0!==em?em:0,ea.countConversationTurns=el,ea.countUserSubmittedMessages=eh,ea.countLastUserPromptTextMessageLength=eu)),d.A.logEvent(c.M.generateCompletion,ea)):!D&&(ep=_.containsNodeOrMessageId(X.id),eg=null===(ef=X.metadata)||void 0===ef?void 0:ef.parent_id,ep||($.flush(),w.tQ.updateTree(e,function(e){if(null==eg)throw Error("Received a message with no parentId: ".concat(JSON.stringify(X)));e.addNode(X.id,X,eg,h.uU.Assistant)})),null!=eg&&eg===T&&null!=(ev=V[eg])&&(w.tQ.updateTree(e,function(e){Z(e,ev)}),delete V[eg]),(u=(null!==(ex=null==M?void 0:M.num_variants_in_stream)&&void 0!==ex?ex:1)===1||null==T||T===X.id)&&T!==X.id&&(T=X.id,N=X.id,eb=w.tQ.getThreadCurrentLeafId(e),_.messageIdToNodeId(N)!==_.messageIdToNodeId(eb)&&w.tQ.setThreadCurrentLeafId(e,N),null!=eg&&w.tQ.updateTree(e,function(e){e.updateNodeMetadata(eg,{variantsInStreamInfo:M})}))),u&&(Q=X),W[X.id]=X,V[X.id]=X}if($(),"done"!==a.type)return[3,4];if(H||($.flush(),J||(E&&U.current(y),O.current(y))),w.tQ.updateTree(e,function(e){Object.values(V).forEach(function(t){Z(e,t)})}),Y.onMessageDone(),j(),eM=null===(ey=B.get(t))||void 0===ey?void 0:ey.tags,ew=(0,l.Rr)(x,null!=eM?eM:[],h.OL.PrimaryAssistant),!((null==Q?void 0:null===(ek=Q.metadata)||void 0===ek?void 0:ek.client_actions)!==void 0))return[3,2];return[4,function(e,t){return f.apply(this,arguments)}(e,Q)];case 1:(eT=s.sent()).length>0&&q(e,N,t,ew,B,G,eT,p),s.label=2;case 2:if(!x.has("tools3_dev")||!(eC=(0,A.wR)(Q)))return[3,4];return ej=[e,N,t,ew,B,G],[4,(0,A.qZ)(eC)];case 3:q.apply(void 0,ej.concat([s.sent(),p])),s.label=4;case 4:return[2]}})}),function(e){return g.apply(this,arguments)}},[F,U,O,e]),G=(0,y.useCallback)((g=(0,a._)(function(n){var a,l,d,c,u,m,f,g,v,x,b,y,k,T,C,S,R,A,P,L,Z,q,B,F,U,O,z,G,W;return(0,s.Jh)(this,function(s){switch(s.label){case 0:for(a=n.model,l=n.completionType,d=n.parentNodeId,c=n.metadata,m=void 0===(u=n.focusOnNewCompletion)||u,f=n.completionMetadata,g=n.arkoseToken,v=n.preflightTime,x=n.extraStreamParams,b=n.appendMessages,j.E.publish({kind:"requestCompletion"}),T=w.tQ.getTree(e),w.tQ.retainThread(e),C="".concat(_.Vh).concat(e,"-").concat(E.current++),S="".concat(e,"-").concat(E.current),w.tQ.updateTree(e,function(e){e.addNode(C,"",d,h.uU.Assistant)}),m&&w.tQ.setThreadCurrentLeafId(e,C),A=[],P=T.getNodeByIdOrMessageId(d),L=T.getNodeByIdOrMessageId(P.parentId);null!=L&&((null===(y=L.metadata)||void 0===y?void 0:y.isPlaceholderTemplateAssistantWelcomeMessage)===!0||(null===(k=L.metadata)||void 0===k?void 0:k.isClientCreatedSystemMessage)===!0);){var V,H,J=L.message;A.unshift(J);var Y=T.getNodeByIdOrMessageId(L.parentId);R=null!==(H=null===(V=Y.message)||void 0===V?void 0:V.id)&&void 0!==H?H:Y.id,L=Y}return l===h.Os.Next||l===h.Os.Variant?(q=T.getNodeByIdOrMessageId(P.parentId),null!=R||(R=null!==(B=null===(Z=q.message)||void 0===Z?void 0:Z.id)&&void 0!==B?B:q.id),A.push(P.message),b&&(F=d,w.tQ.updateTree(e,function(e){var t=!0,n=!1,a=void 0;try{for(var r,o=b[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var i=r.value;e.insertNodeBefore(C,{id:i.id,message:i,parentId:F,children:[]}),F=i.id}}catch(e){n=!0,a=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}),A.push.apply(A,(0,i._)(b)))):null!=R||(R=P.message.id),void 0===(U=w.tQ.getServerThreadId(e))&&(0,w.Zz)(e)&&w.tQ.updateInitialThreadDataForNewThread(e,a,p),O=(0,o._)((0,r._)({},x),{model:a,completionType:l,threadId:U,continueFromSharedConversationId:t,historyDisabled:N,parentMessageId:R,messages:A,arkoseToken:null!=g?g:null,enabledPluginIds:p,completionMetadata:f}),z=function(e,t){(0,D.F4)(S,t,e,v)},G=Q(a,l,C,c,S,x),[4,M.ZP.publicApiCompletionStream(O,G,z)];case 1:return W=s.sent(),I.hx.addRequest(C,W),[2]}})}),function(e){return g.apply(this,arguments)}),[e,t,p,Q,N]);return G}}}]);